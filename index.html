<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Stone | ì„ ìˆ ì§‘ ë°°í‹€</title>
    <style>
        :root {
            --mana: #3b82f6;
            --hp: #ef4444;
            --atk: #f59e0b;
            --board: #3d2b1f;
            --card: #1a1a1a;
        }
        body, html { margin: 0; padding: 0; height: 100%; background: #1a1a1a; font-family: 'Georgia', serif; overflow: hidden; color: white; }
        
        #game-board {
            display: flex; flex-direction: column; height: 100vh; max-width: 600px; margin: 0 auto;
            background: radial-gradient(circle, #4d3227 0%, #2b1b14 100%);
            border: 8px solid #1a110d; box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
            position: relative;
        }

        /* ì˜ì›… ì˜ì—­ */
        .hero-area {
            display: flex; justify-content: center; align-items: center; padding: 10px; gap: 20px; height: 100px;
        }
        .hero-portrait {
            width: 70px; height: 90px; background: #555; border: 3px solid #ccc; border-radius: 50% 50% 10% 10%;
            position: relative; display: flex; justify-content: center; align-items: flex-end;
            background-size: cover; background-position: center;
        }
        .hero-hp { position: absolute; bottom: -5px; right: -5px; background: var(--hp); border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; }
        
        .hero-power {
            width: 50px; height: 50px; border-radius: 50%; background: #444; border: 2px solid #daa520;
            cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px;
        }

        /* ì „ì¥ */
        #field {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: center; gap: 20px; padding: 10px;
        }
        .minion-row {
            display: flex; justify-content: center; gap: 8px; height: 110px; align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        /* í•˜ìˆ˜ì¸ ì¹´ë“œ */
        .minion {
            width: 70px; height: 90px; background: #222; border: 2px solid #888; border-radius: 10px;
            position: relative; display: flex; flex-direction: column; justify-content: flex-end;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .minion.taunt { border: 4px solid #daa520; box-shadow: 0 0 10px #daa520; }
        .minion .cost { position: absolute; top: -5px; left: -5px; background: var(--mana); border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid white; }
        .minion .stats { display: flex; justify-content: space-between; padding: 2px 5px; font-weight: bold; font-size: 14px; }
        .minion .stats .atk { color: var(--atk); }
        .minion .stats .hp { color: var(--hp); }
        .minion .emoji { font-size: 30px; text-align: center; position: absolute; top: 20px; width: 100%; }

        /* í•¸ë“œ */
        #hand {
            height: 120px; background: rgba(0,0,0,0.4); display: flex; justify-content: center; align-items: flex-start; padding-top: 10px; gap: -15px;
        }
        #hand .minion { cursor: pointer; margin: 0 -5px; }
        #hand .minion:hover { transform: translateY(-30px) scale(1.2); z-index: 100; border-color: var(--mana); }

        /* ìì› ë°” */
        .resource-bar {
            display: flex; justify-content: flex-end; padding: 5px 20px; gap: 5px;
        }
        .mana-crystal { width: 12px; height: 12px; background: var(--mana); transform: rotate(45deg); border: 1px solid white; }
        .mana-crystal.empty { background: #333; border-color: #555; }

        /* ë²„íŠ¼ */
        #end-turn-btn {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: #facc15; color: #3d2b1f; border: 3px solid #3d2b1f; padding: 10px 15px;
            font-weight: bold; cursor: pointer; border-radius: 5px; box-shadow: 0 4px 0 #854d0e;
        }
        #end-turn-btn:active { transform: translateY(-50%) translateY(2px); box-shadow: 0 2px 0 #854d0e; }

        #toast {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 40px; font-weight: 900; text-shadow: 0 0 20px black; pointer-events: none; display: none; z-index: 1000;
        }
    </style>
</head>
<body>

    <div id="game-board">
        <!-- ìƒëŒ€ ì˜ì›… -->
        <div class="hero-area">
            <div class="hero-portrait" style="border-color: #ef4444;">
                <div class="hero-hp" id="enemy-hp">30</div>
                <div style="font-size: 40px;">ğŸ‘¹</div>
            </div>
            <div class="hero-power">ğŸ”¥</div>
        </div>

        <div id="field">
            <div class="minion-row" id="enemy-minions"></div>
            <div id="end-turn-btn" onclick="endTurn()">í„´ ì¢…ë£Œ</div>
            <div class="minion-row" id="player-minions"></div>
        </div>

        <!-- í”Œë ˆì´ì–´ ë§ˆë‚˜ -->
        <div class="resource-bar" id="mana-bar"></div>

        <!-- í”Œë ˆì´ì–´ ì˜ì›… -->
        <div class="hero-area">
            <div class="hero-portrait" style="border-color: #3b82f6;">
                <div class="hero-hp" id="player-hp">30</div>
                <div style="font-size: 40px;">ğŸ§™</div>
            </div>
            <div class="hero-power" onclick="useHeroPower()">âœ¨</div>
        </div>

        <!-- í”Œë ˆì´ì–´ í•¸ë“œ -->
        <div id="hand"></div>

        <div id="toast">ë‚´ ì°¨ë¡€</div>
    </div>

    <script>
        const CARDS = [
            { name: "í’‹ë‚´ê¸° ê¸°ìˆ ì", cost: 1, atk: 1, hp: 1, emoji: "ğŸ¤–", battlecry: 'draw' },
            { name: "ê³¨ë“œì…” ë³´ë³‘", cost: 1, atk: 1, hp: 2, emoji: "ğŸ›¡ï¸", taunt: true },
            { name: "ë¯¼ë¬¼ì•…ì–´", cost: 2, atk: 2, hp: 3, emoji: "ğŸŠ" },
            { name: "ì„¼ì§„ ë°©íŒ¨ëŒ€ê°€", cost: 4, atk: 3, hp: 5, emoji: "ğŸ‘¹", taunt: true },
            { name: "ë§ˆê·¸ë§ˆ í“¨ë¦¬", cost: 3, atk: 5, hp: 1, emoji: "ğŸ”¥" },
            { name: "ë°ìŠ¤ìœ™", cost: 8, atk: 12, hp: 12, emoji: "ğŸ²" }
        ];

        let state = {
            player: { hp: 30, mana: 1, maxMana: 1, hand: [], field: [], usedPower: false },
            enemy: { hp: 30, mana: 1, maxMana: 1, field: [] },
            turn: 'player'
        };

        function init() {
            for(let i=0; i<3; i++) drawCard(state.player);
            update();
            showToast("ì „íˆ¬ ì‹œì‘!");
        }

        function drawCard(p) {
            if(p.hand.length < 8) {
                const card = CARDS[Math.floor(Math.random()*CARDS.length)];
                p.hand.push({ ...card, id: Math.random(), curAtk: card.atk, curHp: card.hp });
            }
        }

        function playCard(card) {
            if(state.turn !== 'player' || state.player.mana < card.cost || state.player.field.length >= 7) return;
            state.player.mana -= card.cost;
            state.player.hand = state.player.hand.filter(c => c.id !== card.id);
            state.player.field.push(card);
            if(card.battlecry === 'draw') drawCard(state.player);
            update();
        }

        function useHeroPower() {
            if(state.turn !== 'player' || state.player.mana < 2 || state.player.usedPower) return;
            state.player.mana -= 2;
            state.player.usedPower = true;
            state.enemy.hp -= 1; // í™”ì—¼ ì‘ë ¬ ì‹œë®¬ë ˆì´ì…˜
            update();
        }

        async function endTurn() {
            if(state.turn !== 'player') return;
            state.turn = 'enemy';
            
            // ì „íˆ¬ ì‹œë®¬ë ˆì´ì…˜
            await battle();
            
            // AI í„´
            showToast("ì ì˜ ì°¨ë¡€");
            await sleep(1000);
            aiPlay();
            
            // ë‹¤ì‹œ ë‚´ í„´
            state.player.maxMana = Math.min(state.player.maxMana + 1, 10);
            state.player.mana = state.player.maxMana;
            state.player.usedPower = false;
            drawCard(state.player);
            state.turn = 'player';
            showToast("ë‚´ ì°¨ë¡€");
            update();
        }

        async function battle() {
            // ë„ë°œ í•˜ìˆ˜ì¸ ìš°ì„  íƒ€ê²© ë¡œì§ í¬í•¨
            for(let m of state.player.field) {
                const target = state.enemy.field.find(e => e.taunt) || state.enemy.field[0];
                if(target) {
                    target.curHp -= m.curAtk;
                    m.curHp -= target.curAtk;
                } else {
                    state.enemy.hp -= m.curAtk;
                }
                cleanField();
                update();
                await sleep(300);
            }
            // ì  ê³µê²©ë„ ìœ ì‚¬í•˜ê²Œ ì²˜ë¦¬...
        }

        function aiPlay() {
            let mana = state.enemy.maxMana;
            while(mana > 0 && state.enemy.field.length < 7) {
                const card = CARDS.filter(c => c.cost <= mana)[0];
                if(!card) break;
                state.enemy.field.push({ ...card, id: Math.random(), curAtk: card.atk, curHp: card.hp });
                mana -= card.cost;
            }
            state.enemy.maxMana = Math.min(state.enemy.maxMana + 1, 10);
        }

        function cleanField() {
            state.player.field = state.player.field.filter(m => m.curHp > 0);
            state.enemy.field = state.enemy.field.filter(m => m.curHp > 0);
        }

        function update() {
            document.getElementById('player-hp').innerText = state.player.hp;
            document.getElementById('enemy-hp').innerText = state.enemy.hp;
            
            const mb = document.getElementById('mana-bar');
            mb.innerHTML = '';
            for(let i=0; i<10; i++) {
                const c = document.createElement('div');
                c.className = 'mana-crystal' + (i >= state.player.mana ? ' empty' : '') + (i >= state.player.maxMana ? ' hide' : '');
                if(i < state.player.maxMana) mb.appendChild(c);
            }

            const handEl = document.getElementById('hand');
            handEl.innerHTML = '';
            state.player.hand.forEach(c => {
                const el = createMinionEl(c);
                el.onclick = () => playCard(c);
                handEl.appendChild(el);
            });

            const pf = document.getElementById('player-minions');
            pf.innerHTML = '';
            state.player.field.forEach(c => pf.appendChild(createMinionEl(c)));

            const ef = document.getElementById('enemy-minions');
            ef.innerHTML = '';
            state.enemy.field.forEach(c => ef.appendChild(createMinionEl(c)));
        }

        function createMinionEl(c) {
            const div = document.createElement('div');
            div.className = 'minion' + (c.taunt ? ' taunt' : '');
            div.innerHTML = `
                <div class="cost">${c.cost}</div>
                <div class="emoji">${c.emoji}</div>
                <div class="stats">
                    <span class="atk">${c.curAtk}</span>
                    <span class="hp">${c.curHp}</span>
                </div>
            `;
            return div;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 1000);
        }
        function sleep(ms) { return new Promise(r => setTimeout(resolve, ms)); }
        init();
    </script>
</body>
</html>
