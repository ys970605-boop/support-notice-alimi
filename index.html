<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Conquest RTS | 4ì¸ ëŒ€í•­ì „</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Courier New', Courier, monospace; color: #0f0; touch-action: none; }
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        #res-panel { position: absolute; top: 15px; right: 15px; background: rgba(0,30,0,0.8); border: 2px solid #0f0; padding: 10px 20px; border-radius: 5px; font-weight: bold; pointer-events: auto; }
        .res-val { color: #fadb14; font-size: 20px; }

        #build-panel { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,30,0,0.9); border: 2px solid #0f0; padding: 15px; border-radius: 10px; 
            display: none; pointer-events: auto; gap: 15px;
        }
        .build-btn { 
            background: #020; color: #0f0; border: 1px solid #0f0; padding: 10px; 
            cursor: pointer; text-align: center; font-size: 12px; min-width: 90px;
        }
        .build-btn:hover { background: #040; }
        .build-btn:active { background: #080; }

        #msg-log { position: absolute; bottom: 20px; left: 20px; color: #0f0; font-size: 14px; text-shadow: 1px 1px 2px #000; }
        #game-over { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; border: 3px solid #f00; padding: 40px; text-align: center; display: none; pointer-events: auto; }
        
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="game-ui">
        <div id="res-panel">RESOURCES: <span id="gold-val" class="res-val">500</span></div>
        <div id="msg-log">ì „ì¥ ì§„ì…... 7ì‹œ ë°©í–¥ì´ ë‹¹ì‹ ì˜ ë³¸ë¶€ì…ë‹ˆë‹¤.</div>
        
        <div id="build-panel">
            <button class="build-btn" onclick="produceUnit('worker')">SCV (â›ï¸)<br>50G</button>
            <button class="build-btn" onclick="produceUnit('soldier')">MARINE (âš”ï¸)<br>100G</button>
        </div>

        <div id="game-over">
            <h1 id="over-title" style="color:#f00">MISSION FAILED</h1>
            <p id="over-msg">ë³¸ë¶€ê°€ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <button onclick="location.reload()" style="background:#0f0; color:#000; border:none; padding:10px 20px; cursor:pointer; font-weight:bold;">RESTART</button>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = 2000, H = 2000;
        let camX = 0, camY = 0;
        let gold = 500;

        const TEAMS = [
            { id: 1, name: "í•œêµ­", color: "#52c41a", flag: "ğŸ‡°ğŸ‡·", start: {x: 200, y: 1800} }, // 7ì‹œ
            { id: 2, name: "ì¤‘êµ­", color: "#ff4d4f", flag: "ğŸ‡¨ğŸ‡³", start: {x: 1800, y: 200} },  // 1ì‹œ
            { id: 3, name: "ì¼ë³¸", color: "#d9d9d9", flag: "ğŸ‡¯ğŸ‡µ", start: {x: 200, y: 200} },   // 11ì‹œ
            { id: 4, name: "ë¯¸êµ­", color: "#1890ff", flag: "ğŸ‡ºğŸ‡¸", start: {x: 1800, y: 1800} } // 5ì‹œ
        ];

        let entities = [];
        let minerals = [];

        function initGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // ë¯¸ë„¤ë„ ë°°ì¹˜ (ê° ìŠ¤íƒ€íŒ… í¬ì¸íŠ¸ ê·¼ì²˜ì— 5ê°œì”© + ì¤‘ì•™ì— 20ê°œ)
            TEAMS.forEach(team => {
                for(let i=0; i<5; i++) {
                    minerals.push({
                        x: team.start.x + (Math.random()-0.5)*300,
                        y: team.start.y + (Math.random()-0.5)*300,
                        amount: 1000
                    });
                }
            });
            for(let i=0; i<20; i++) {
                minerals.push({x: 800 + Math.random()*400, y: 800 + Math.random()*400, amount: 2000});
            }

            // ë³¸ë¶€ ë°°ì¹˜
            TEAMS.forEach(team => spawnHQ(team.id, team.start.x, team.start.y));

            // ì¹´ë©”ë¼ë¥¼ í”Œë ˆì´ì–´ ê¸°ì§€(7ì‹œ)ë¡œ ì´ë™
            camX = 0; camY = H - canvas.height;

            setInterval(gameLoop, 50);
            requestAnimationFrame(draw);
        }

        function spawnHQ(teamId, x, y) {
            entities.push({
                id: Math.random(), type: 'hq', team: teamId, x: x, y: y, hp: 2500, maxHp: 2500, size: 80
            });
        }

        function produceUnit(type) {
            const cost = type === 'worker' ? 50 : 100;
            if(gold < cost) {
                document.getElementById('msg-log').innerText = "ìì›ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!";
                return;
            }
            gold -= cost;
            updateUI();

            const hq = entities.find(e => e.team === 1 && e.type === 'hq');
            if(!hq) return;

            entities.push({
                id: Math.random(), type: type, team: 1,
                x: hq.x + (Math.random()-0.5)*150,
                y: hq.y + (Math.random()-0.5)*150,
                hp: type === 'worker' ? 100 : 250,
                maxHp: type === 'worker' ? 100 : 250,
                size: 18,
                speed: type === 'worker' ? 3 : 4.5,
                range: type === 'worker' ? 40 : 120,
                damage: type === 'worker' ? 0 : 15,
                state: 'idle'
            });
        }

        function gameLoop() {
            entities.forEach(e => {
                if(e.type === 'worker') {
                    if(e.state === 'idle') {
                        let nearest = null, minDist = Infinity;
                        minerals.forEach(m => {
                            let d = Math.hypot(m.x - e.x, m.y - e.y);
                            if(d < minDist) { minDist = d; nearest = m; }
                        });
                        e.target = nearest; e.state = 'moving_to_mineral';
                    }
                    if(e.state === 'moving_to_mineral' && e.target) {
                        let d = Math.hypot(e.target.x - e.x, e.target.y - e.y);
                        if(d < 15) {
                            e.state = 'mining';
                            setTimeout(() => { 
                                e.state = 'returning'; 
                                e.target = entities.find(ent => ent.team === e.team && ent.type === 'hq');
                            }, 1500);
                        } else {
                            e.x += (e.target.x - e.x)/d * e.speed;
                            e.y += (e.target.y - e.y)/d * e.speed;
                        }
                    }
                    if(e.state === 'returning' && e.target) {
                        let d = Math.hypot(e.target.x - e.x, e.target.y - e.y);
                        if(d < 50) {
                            if(e.team === 1) gold += 15;
                            updateUI(); e.state = 'idle';
                        } else {
                            e.x += (e.target.x - e.x)/d * e.speed;
                            e.y += (e.target.y - e.y)/d * e.speed;
                        }
                    }
                }

                if(e.type === 'soldier') {
                    let nearestEnemy = entities.find(ent => ent.team !== e.team && ent.hp > 0);
                    if(nearestEnemy) {
                        let d = Math.hypot(nearestEnemy.x - e.x, nearestEnemy.y - e.y);
                        if(d < e.range) {
                            nearestEnemy.hp -= e.damage / 15;
                        } else {
                            e.x += (nearestEnemy.x - e.x)/d * e.speed;
                            e.y += (nearestEnemy.y - e.y)/d * e.speed;
                        }
                    }
                }
            });

            // ìŠ¹ë¦¬/íŒ¨ë°° ì¡°ê±´
            const hqs = entities.filter(e => e.type === 'hq');
            const myHq = hqs.find(h => h.team === 1);
            if(!myHq) {
                showEndScreen("MISSION FAILED", "ë‹¹ì‹ ì˜ ë³¸ë¶€ê°€ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else if(hqs.length === 1 && hqs[0].team === 1) {
                showEndScreen("VICTORY!", "ëª¨ë“  ì êµ­ì„ ì •ë³µí–ˆìŠµë‹ˆë‹¤!");
            }

            entities = entities.filter(e => e.hp > 0);

            // AI (ë´‡) ìƒì‚° ë¡œì§
            if(Math.random() < 0.02) {
                [2,3,4].forEach(tId => {
                    let hq = entities.find(ent => ent.team === tId && ent.type === 'hq');
                    if(hq) {
                        const unitType = Math.random() < 0.3 ? 'worker' : 'soldier';
                        entities.push({
                            id: Math.random(), type: unitType, team: tId, x: hq.x, y: hq.y,
                            hp: unitType==='worker'?100:250, maxHp: unitType==='worker'?100:250, 
                            size: 18, speed: 3, range: 120, damage: 15, state: 'idle'
                        });
                    }
                });
            }
        }

        function showEndScreen(title, msg) {
            const screen = document.getElementById('game-over');
            document.getElementById('over-title').innerText = title;
            document.getElementById('over-title').style.color = title === "VICTORY!" ? "#0f0" : "#f00";
            document.getElementById('over-msg').innerText = msg;
            screen.style.display = 'block';
        }

        function updateUI() {
            document.getElementById('gold-val').innerText = Math.floor(gold);
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(-camX, -camY);

            // ë°°ê²½ ê²©ì
            ctx.strokeStyle = '#020';
            for(let i=0; i<=W; i+=100) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,H); ctx.stroke(); }
            for(let i=0; i<=H; i+=100) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            // ë¯¸ë„¤ë„
            minerals.forEach(m => {
                ctx.fillStyle = '#0ff';
                ctx.beginPath(); ctx.arc(m.x, m.y, 12, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 10; ctx.shadowColor = '#0ff';
                ctx.fillStyle = '#fff'; ctx.font = 'bold 10px Arial';
                ctx.fillText('CRYSTAL', m.x - 22, m.y - 18);
                ctx.shadowBlur = 0;
            });

            // ìœ ë‹› ë° ê±´ë¬¼
            entities.forEach(e => {
                const team = TEAMS.find(t => t.id === e.team);
                ctx.fillStyle = team.color;
                
                if(e.type === 'hq') {
                    ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
                    ctx.strokeRect(e.x - e.size/2, e.y - e.size/2, e.size, e.size);
                    ctx.fillRect(e.x - e.size/2, e.y - e.size/2, e.size, e.size);
                    ctx.fillStyle = '#fff'; ctx.font = '30px Arial';
                    ctx.fillText(team.flag, e.x-20, e.y+12);
                } else {
                    ctx.beginPath(); ctx.arc(e.x, e.y, e.size, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = '#fff'; ctx.font = 'bold 14px Arial';
                    ctx.fillText(e.type === 'worker' ? 'â›ï¸' : 'âš”ï¸', e.x-10, e.y+6);
                }

                // HP Bar
                ctx.fillStyle = '#500';
                ctx.fillRect(e.x - 30, e.y - e.size - 15, 60, 5);
                ctx.fillStyle = '#0f0';
                ctx.fillRect(e.x - 30, e.y - e.size - 15, 60 * (e.hp/e.maxHp), 5);
            });

            ctx.restore();
            requestAnimationFrame(draw);
        }

        // ì¡°ì‘: ë³¸ë¶€ í´ë¦­ ì‹œ ìƒì‚° ë©”ë‰´
        canvas.addEventListener('mousedown', e => {
            const x = e.clientX + camX;
            const y = e.clientY + camY;
            const clicked = entities.find(ent => Math.hypot(ent.x - x, ent.y - y) < ent.size + 10);
            
            if(clicked && clicked.team === 1 && clicked.type === 'hq') {
                document.getElementById('build-panel').style.display = 'flex';
                document.getElementById('msg-log').innerText = "ë³¸ë¶€(HQ) ëª…ë ¹ ëŒ€ê¸° ì¤‘...";
            } else {
                document.getElementById('build-panel').style.display = 'none';
            }
        });

        // ì¹´ë©”ë¼ ë“œë˜ê·¸ ì´ë™
        let isDragging = false, lastX, lastY;
        canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
        window.addEventListener('mousemove', e => {
            if(!isDragging) return;
            camX -= (e.clientX - lastX);
            camY -= (e.clientY - lastY);
            lastX = e.clientX; lastY = e.clientY;
            camX = Math.max(0, Math.min(W - canvas.width, camX));
            camY = Math.max(0, Math.min(H - canvas.height, camY));
        });
        window.addEventListener('mouseup', () => isDragging = false);

        initGame();
    </script>
</body>
</html>
