<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Infection .io | í…Œí¬ë‹ˆì»¬ ì›”ë“œ ë§µ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #050505; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: #ff4d4f; touch-action: none; }
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        #news-ticker {
            position: absolute; top: 0; left: 0; width: 100%; background: rgba(139, 0, 0, 0.9); color: white; padding: 10px; font-size: 14px; font-weight: bold; overflow: hidden; white-space: nowrap; border-bottom: 2px solid #ff0000;
        }
        .ticker-move { display: inline-block; animation: ticker 30s linear infinite; }
        @keyframes ticker { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        #data-panel {
            position: absolute; bottom: 20px; right: 20px; background: rgba(0,0,0,0.9); border: 2px solid #ff4d4f; padding: 15px; border-radius: 10px; width: 260px; pointer-events: auto; box-shadow: 0 0 30px rgba(255,0,0,0.2);
        }
        .data-stat { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px; font-weight: bold; }
        .dna-val { color: #fadb14; }

        .evolve-btn {
            width: 100%; padding: 12px; background: #8b0000; color: white; border: 1px solid #ff4d4f; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 8px;
        }
        .evolve-btn:hover { background: #ff0000; }

        #ranking-board { position: absolute; top: 60px; left: 20px; background: rgba(0,0,0,0.8); border-left: 5px solid #ff4d4f; padding: 15px; min-width: 220px; border-radius: 0 10px 10px 0; }
        .rank-row { font-size: 14px; margin-bottom: 8px; font-weight: 600; }

        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 20px; font-weight: bold; z-index: 1000; }
        
        canvas { display: block; background: #000; }
    </style>
</head>
<body>
    <div id="loading">ì§€êµ¬ ë°ì´í„° ìŠ¤ìº” ì¤‘...</div>
    <div id="game-ui">
        <div id="news-ticker"><div class="ticker-move" id="ticker-text">ê²½ê³ : ì „ ì§€êµ¬ì  ê°ì—¼ ì‚¬íƒœ ë°œìƒ... ëª¨ë“  êµ­ê²½ íì‡„ ê²€í†  ì¤‘... í•œêµ­ë°œ ë³€ì¢… ë°”ì´ëŸ¬ìŠ¤ ì¹˜ëª…ë¥  ê¸‰ìƒìŠ¹...</div></div>
        
        <div id="ranking-board">
            <div style="font-size: 11px; margin-bottom: 10px; color: #888; letter-spacing: 2px;">STRATEGIC MAP STATUS</div>
            <div id="ranks"></div>
        </div>

        <div id="data-panel">
            <div class="data-stat">DNA: <span id="dna-val" class="dna-val">500</span></div>
            <div class="data-stat" style="font-size: 14px;">ê°ì—¼ë¥ : <span id="infect-rate">0.1</span>%</div>
            <button class="evolve-btn" onclick="spawnUnit('infector')">â˜£ï¸ ê°ì—¼ì²´ íŒŒê²¬</button>
            <button class="evolve-btn" onclick="spawnUnit('mutant')">ğŸ§Ÿ ë³€ì¢… ê´´ìˆ˜ ìƒì„±</button>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = 3000, H = 1800;
        let camX = 1500, camY = 900, zoom = 0.4, dna = 500;
        let entities = [], projectiles = [];
        
        // ë” ì•ˆì •ì ì¸ ì„¸ê³„ ì§€ë„ ì´ë¯¸ì§€ ì£¼ì†Œ
        const worldMap = new Image();
        worldMap.crossOrigin = "anonymous";
        worldMap.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Equirectangular_projection_SW.jpg/1280px-Equirectangular_projection_SW.jpg';
        
        worldMap.onload = () => {
            document.getElementById('loading').style.display = 'none';
        };

        const TEAMS = [
            { id: 1, name: "Virus(KR)", color: "#ff0000", flag: "â˜£ï¸", start: {x: 2450, y: 1250}, alive: true },
            { id: 2, name: "North America", color: "#1890ff", flag: "ğŸ›¡ï¸", start: {x: 600, y: 550}, alive: true },
            { id: 3, name: "Europe", color: "#ffffff", flag: "ğŸ¥", start: {x: 1550, y: 500}, alive: true },
            { id: 4, name: "South America", color: "#52c41a", flag: "ğŸŒ³", start: {x: 900, y: 1350}, alive: true }
        ];

        function initGame() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            TEAMS.forEach(team => {
                entities.push({ id: Math.random(), type: 'core', team: team.id, x: team.start.x, y: team.start.y, hp: 6000, maxHp: 6000, size: 140 });
            });
            
            // ì „ ì„¸ê³„ê°€ ë‹¤ ë³´ì´ë„ë¡ ì´ˆê¸° ì¤Œ ì„¤ì •
            zoom = Math.min(canvas.width/W, canvas.height/H) * 0.9;
            camX = W/2; camY = H/2;

            setInterval(gameLoop, 50);
            requestAnimationFrame(draw);
        }

        function spawnUnit(type) {
            const cost = type === 'infector' ? 100 : 300;
            if(dna < cost) return;
            dna -= cost; updateUI();
            const core = entities.find(e => e.team === 1 && e.type === 'core');
            if(!core) return;
            const u = { id: Math.random(), type: type, team: 1, x: core.x, y: core.y, state: 'idle', cooldown: 0, targetPos: null };
            if(type === 'infector') { u.hp = 300; u.maxHp = 300; u.size = 25; u.speed = 8; u.range = 180; u.damage = 50; }
            else { u.hp = 1500; u.maxHp = 1500; u.size = 50; u.speed = 4; u.range = 400; u.damage = 200; u.splash = 200; }
            entities.push(u);
        }

        function gameLoop() {
            projectiles.forEach((p, idx) => {
                if(!p.target || p.target.hp <= 0) { projectiles.splice(idx, 1); return; }
                const d = Math.hypot(p.target.x - p.x, p.target.y - p.y);
                if(d < 20) {
                    if(p.splash) entities.forEach(ent => { if(ent.team !== p.team && Math.hypot(ent.x - p.x, ent.y - p.y) < p.splash) ent.hp -= p.damage; });
                    else p.target.hp -= p.damage;
                    projectiles.splice(idx, 1);
                } else { p.x += (p.target.x - p.x)/d * p.speed; p.y += (p.target.y - p.y)/d * p.speed; }
            });

            entities.forEach(e => {
                if(!e.targetPos && e.speed > 0) {
                    let enemy = entities.find(ent => ent.team !== e.team && ent.hp > 0);
                    if(enemy) e.targetPos = { x: enemy.x + (Math.random()-0.5)*400, y: enemy.y + (Math.random()-0.5)*400 };
                }
                if(e.targetPos && e.speed > 0) {
                    const d = Math.hypot(e.targetPos.x - e.x, e.targetPos.y - e.y);
                    if(d > 10) { e.x += (e.targetPos.x - e.x)/d * e.speed; e.y += (e.targetPos.y - e.y)/d * e.speed; }
                    else e.targetPos = null;
                }
                if(e.type !== 'core') {
                    if(e.cooldown > 0) e.cooldown--;
                    let enemy = entities.find(ent => ent.team !== e.team && ent.hp > 0 && Math.hypot(ent.x - e.x, ent.y - e.y) < e.range);
                    if(enemy && e.cooldown <= 0) {
                        projectiles.push({ x: e.x, y: e.y, target: enemy, speed: 30, damage: e.damage, team: e.team, type: e.type, splash: e.splash });
                        e.cooldown = e.type === 'mutant' ? 40 : 15;
                    }
                }
            });

            if(Math.random() < 0.1) dna += 5; updateUI();
            entities = entities.filter(e => e.hp > 0);
            document.getElementById('infect-rate').innerText = (entities.filter(e => e.team === 1).length / 10).toFixed(1);
            updateRanking();
        }

        function draw() {
            ctx.fillStyle = '#050505'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2);
            ctx.scale(zoom, zoom);
            ctx.translate(-camX, -camY);

            // 1. ë°°ê²½ ì§€ë„ ë“œë¡œì‰
            if (worldMap.complete) {
                ctx.globalAlpha = 0.7;
                ctx.drawImage(worldMap, 0, 0, W, H);
                ctx.globalAlpha = 1.0;
            }

            // 2. í…Œí¬ë‹ˆì»¬ ê·¸ë¦¬ë“œ ë ˆì´ì–´
            ctx.strokeStyle = 'rgba(255, 0, 0, 0.2)'; ctx.lineWidth = 2;
            for(let i=0; i<=W; i+=200) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,H); ctx.stroke(); }
            for(let i=0; i<=H; i+=200) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            // 3. ê°ì—¼ íˆíŠ¸ë§µ (Glow)
            entities.filter(e => e.team === 1).forEach(e => {
                const grad = ctx.createRadialGradient(e.x, e.y, 0, e.x, e.y, 350);
                grad.addColorStop(0, 'rgba(255, 0, 0, 0.3)');
                grad.addColorStop(1, 'rgba(255, 0, 0, 0)');
                ctx.fillStyle = grad; ctx.fillRect(e.x-350, e.y-350, 700, 700);
            });

            // 4. ìœ ë‹› ë° íˆ¬ì‚¬ì²´
            projectiles.forEach(p => {
                ctx.fillStyle = '#ff0000'; ctx.beginPath(); ctx.arc(p.x, p.y, 12, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 20; ctx.shadowColor = '#f00';
            });
            ctx.shadowBlur = 0;

            entities.forEach(e => {
                const team = TEAMS.find(t => t.id === e.team);
                ctx.save();
                ctx.shadowBlur = 25; ctx.shadowColor = team.color;
                ctx.fillStyle = team.color;
                if(e.type === 'core') {
                    ctx.beginPath(); ctx.arc(e.x, e.y, e.size/2, 0, Math.PI*2); ctx.fill();
                    ctx.strokeStyle = '#fff'; ctx.lineWidth = 6; ctx.stroke();
                    ctx.fillStyle = '#fff'; ctx.font = 'bold 70px Arial'; ctx.textAlign='center'; ctx.textBaseline='middle';
                    ctx.fillText(team.flag, e.x, e.y+5);
                } else {
                    ctx.beginPath(); ctx.arc(e.x, e.y, e.size, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = '#000'; ctx.font = 'bold 24px Arial'; ctx.textAlign='center'; ctx.textBaseline='middle';
                    ctx.fillText(e.type==='infector'?'â˜£ï¸':'ğŸ§Ÿ', e.x, e.y+3);
                }
                ctx.restore();
                // HP Bar
                ctx.fillStyle = 'rgba(255,0,0,0.4)'; ctx.fillRect(e.x - 70, e.y - e.size - 30, 140, 12);
                ctx.fillStyle = team.color; ctx.fillRect(e.x - 70, e.y - e.size - 30, 140 * (e.hp/e.maxHp), 12);
            });

            ctx.restore(); requestAnimationFrame(draw);
        }

        function updateRanking() {
            let html = '';
            TEAMS.forEach(t => {
                const alive = entities.some(e => e.team === t.id && e.type === 'core');
                html += `<div class="rank-row" style="color:${t.color}; opacity:${alive?1:0.3}">
                    <span>${t.flag} ${t.name}</span>: ${alive?'[THREAT]':'[EXTINCT]'}
                </div>`;
            });
            document.getElementById('ranks').innerHTML = html;
        }

        function updateUI() { document.getElementById('dna-val').innerText = Math.floor(dna); }
        canvas.addEventListener('wheel', e => { zoom *= (e.deltaY > 0 ? 0.8 : 1.2); zoom = Math.max(0.1, Math.min(4.0, zoom)); });
        let isD = false, lx, ly;
        canvas.addEventListener('mousedown', e => { isD = true; lx = e.clientX; ly = e.clientY; });
        window.addEventListener('mousemove', e => { if(isD) { camX -= (e.clientX - lx)/zoom; camY -= (e.clientY - ly)/zoom; lx = e.clientX; ly = e.clientY; } });
        window.addEventListener('mouseup', () => isD = false);
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        initGame();
    </script>
</body>
</html>
