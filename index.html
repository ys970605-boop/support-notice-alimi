<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 0.3s;
    }
    
    body.dark-mode {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }
    
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 100%;
      transition: background 0.3s, color 0.3s;
      position: relative;
    }
    
    body.dark-mode .container {
      background: #2d2d44;
      color: #e0e0e0;
    }
    
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .theme-toggle:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
      transition: color 0.3s;
    }
    
    body.dark-mode h1 {
      color: #e0e0e0;
    }
    
    .subtitle {
      text-align: center;
      color: #999;
      margin-bottom: 30px;
      font-size: 14px;
      transition: color 0.3s;
    }
    
    body.dark-mode .subtitle {
      color: #a0a0a0;
    }
    
    .lotto-section {
      margin-bottom: 30px;
    }
    
    .lotto-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
      transition: color 0.3s;
    }
    
    body.dark-mode .lotto-title {
      color: #e0e0e0;
    }
    
    .numbers-display {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .number-ball {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: transform 0.2s;
    }
    
    .number-ball:not(.empty):hover {
      transform: scale(1.1);
    }
    
    .number-ball.empty {
      background: #f0f0f0;
      color: #999;
    }
    
    body.dark-mode .number-ball.empty {
      background: #404050;
      color: #606070;
    }
    
    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .btn {
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
    }
    
    .btn-generate {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      grid-column: span 2;
    }
    
    .btn-generate:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-generate:active {
      transform: translateY(0);
    }
    
    .btn-save {
      background: #f0f0f0;
      color: #333;
      flex: 1;
    }
    
    .btn-save:hover {
      background: #e0e0e0;
    }
    
    .btn-copy {
      background: #667eea;
      color: white;
      flex: 1;
    }
    
    .btn-copy:hover {
      background: #5568d3;
    }
    
    .history {
      margin-top: 30px;
      border-top: 1px solid #f0f0f0;
      padding-top: 20px;
    }
    
    .history-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
    }
    
    .history-item {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    
    .history-numbers {
      font-weight: 600;
      color: #333;
    }
    
    .history-time {
      color: #999;
      font-size: 12px;
    }
    
    .btn-delete {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      padding: 0;
      font-size: 16px;
      margin-left: 10px;
    }
    
    .btn-delete:hover {
      color: #ff6b6b;
    }
    
    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .stat-box {
      text-align: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
    }
    
    .stat-label {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }
    
    .copy-notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    
    .copy-notification.show {
      opacity: 1;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ€ ë¡œë˜ ë²ˆí˜¸</h1>
  <p class="subtitle">í–‰ìš´ì˜ ë²ˆí˜¸ë¥¼ ì¶”ì²œë°›ìœ¼ì„¸ìš”</p>
  
  <div class="stats">
    <div class="stat-box">
      <div class="stat-value" id="totalCount">0</div>
      <div class="stat-label">ìƒì„± íšŸìˆ˜</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="savedCount">0</div>
      <div class="stat-label">ì €ì¥ëœ ë²ˆí˜¸</div>
    </div>
  </div>
  
  <div class="lotto-section">
    <div class="lotto-title">ì¶”ì²œ ë²ˆí˜¸</div>
    <div class="numbers-display" id="numbersDisplay">
      <div class="number-ball empty">-</div>
      <div class="number-ball empty">-</div>
      <div class="number-ball empty">-</div>
      <div class="number-ball empty">-</div>
      <div class="number-ball empty">-</div>
      <div class="number-ball empty">-</div>
    </div>
    
    <div class="button-group">
      <button class="btn btn-generate" onclick="generateLottoNumbers()">ğŸ² ë²ˆí˜¸ ìƒì„±</button>
    </div>
    
    <div class="button-group" style="margin-top: 10px;">
      <button class="btn btn-save" onclick="saveLottoNumbers()">ğŸ’¾ ì €ì¥</button>
      <button class="btn btn-copy" onclick="copyLottoNumbers()">ğŸ“‹ ë³µì‚¬</button>
    </div>
  </div>
  
  <div class="history">
    <div class="history-title">ì €ì¥ëœ ë²ˆí˜¸ ëª©ë¡</div>
    <div id="historyContainer"></div>
    <div id="emptyMessage" style="text-align: center; color: #999; font-size: 14px; padding: 20px;">
      ì €ì¥ëœ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤
    </div>
  </div>
</div>

<div class="copy-notification" id="notification"></div>

<script>
  let currentNumbers = [];
  let savedNumbers = [];
  const STORAGE_KEY = 'lottoSavedNumbers';
  const STATS_KEY = 'lottoStats';
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  function init() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      savedNumbers = JSON.parse(saved);
    }
    const stats = localStorage.getItem(STATS_KEY);
    if (stats) {
      const statData = JSON.parse(stats);
      document.getElementById('totalCount').textContent = statData.totalCount || 0;
    }
    updateHistoryDisplay();
  }
  
  // ë¡œë˜ ë²ˆí˜¸ ìƒì„± (1-45 ë²”ìœ„ì—ì„œ ì¤‘ë³µ ì—†ì´ 6ê°œ ì„ íƒ)
  function generateLottoNumbers() {
    currentNumbers = [];
    while (currentNumbers.length < 6) {
      const num = Math.floor(Math.random() * 45) + 1;
      if (!currentNumbers.includes(num)) {
        currentNumbers.push(num);
      }
    }
    currentNumbers.sort((a, b) => a - b);
    displayNumbers();
    updateStats('totalCount', 1);
  }
  
  // ë²ˆí˜¸ í™”ë©´ì— í‘œì‹œ
  function displayNumbers() {
    const display = document.getElementById('numbersDisplay');
    display.innerHTML = '';
    currentNumbers.forEach(num => {
      const ball = document.createElement('div');
      ball.className = 'number-ball';
      ball.textContent = String(num).padStart(2, '0');
      display.appendChild(ball);
    });
  }
  
  // ë²ˆí˜¸ ì €ì¥
  function saveLottoNumbers() {
    if (currentNumbers.length !== 6) {
      showNotification('ë¨¼ì € ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”');
      return;
    }
    
    const entry = {
      numbers: currentNumbers.join(', '),
      time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })
    };
    
    savedNumbers.unshift(entry);
    if (savedNumbers.length > 10) {
      savedNumbers.pop();
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(savedNumbers));
    updateHistoryDisplay();
    updateStats('savedCount', 1);
    showNotification('ë²ˆí˜¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
  }
  
  // ë²ˆí˜¸ ë³µì‚¬
  function copyLottoNumbers() {
    if (currentNumbers.length !== 6) {
      showNotification('ë¨¼ì € ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”');
      return;
    }
    
    const text = currentNumbers.join(', ');
    navigator.clipboard.writeText(text).then(() => {
      showNotification('ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
    }).catch(() => {
      showNotification('ë³µì‚¬ ì‹¤íŒ¨');
    });
  }
  
  // ì €ì¥ ëª©ë¡ ì—…ë°ì´íŠ¸
  function updateHistoryDisplay() {
    const container = document.getElementById('historyContainer');
    const emptyMsg = document.getElementById('emptyMessage');
    
    container.innerHTML = '';
    
    if (savedNumbers.length === 0) {
      emptyMsg.style.display = 'block';
      return;
    }
    
    emptyMsg.style.display = 'none';
    
    savedNumbers.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `
        <div>
          <div class="history-numbers">${item.numbers}</div>
          <div class="history-time">${item.time}</div>
        </div>
        <button class="btn-delete" onclick="deleteHistory(${index})">âœ•</button>
      `;
      container.appendChild(div);
    });
  }
  
  // ì €ì¥ëœ í•­ëª© ì‚­ì œ
  function deleteHistory(index) {
    savedNumbers.splice(index, 1);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(savedNumbers));
    updateHistoryDisplay();
  }
  
  // í†µê³„ ì—…ë°ì´íŠ¸
  function updateStats(key, value) {
    let stats = JSON.parse(localStorage.getItem(STATS_KEY) || '{}');
    stats[key] = (stats[key] || 0) + value;
    localStorage.setItem(STATS_KEY, JSON.stringify(stats));
    document.getElementById(key).textContent = stats[key];
  }
  
  // ì•Œë¦¼ í‘œì‹œ
  function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.classList.add('show');
    setTimeout(() => {
      notification.classList.remove('show');
    }, 2000);
  }
  
  // ì´ˆê¸°í™”
  init();
</script>
</body>
</html>
</div>

<script>
let RAW=[];
const PROFILE_KEY='support_notice_profile_v2';
const BOOKMARK_KEY='support_notice_bookmarks_v1';
let bookmarks=new Set();
let profile={region:'all',stage:'all',field:'all',goal:'all'};


const SOURCE_LABELS={
  kstartup:'K-Startup',
  bizinfo:'ê¸°ì—…ë§ˆë‹¹',
};
function sourceLabel(v){ return SOURCE_LABELS[v]||v||'-'; }

function initData(){
  if(window.GOV_DATA && Array.isArray(window.GOV_DATA.notices)){
    RAW = window.GOV_DATA.notices;
    const updated = window.GOV_DATA.updatedAt || '-';
    document.getElementById('updatedAt').textContent = 'ìµœê·¼ ì—…ë°ì´íŠ¸: ' + updated;
    const srcs = [...new Set((window.GOV_DATA.notices||[]).map(n=>n.source))];
    const srcLabel = (srcs.length ? srcs.map(sourceLabel).join(' + ') : '-');
    document.getElementById('dataSource').textContent = 'ë°ì´í„° ì¶œì²˜: ' + srcLabel;
    document.getElementById('opSource').textContent = 'ìš´ì˜ ì†ŒìŠ¤: ' + srcLabel;
  } else {
    RAW = [];
    document.getElementById('dataSource').textContent = 'ë°ì´í„° ì¶œì²˜: ë¡œë“œ ì‹¤íŒ¨';
  }
}

function loadProfile(){
  try{ profile={...profile,...JSON.parse(localStorage.getItem(PROFILE_KEY)||'{}')}; }catch(e){}
  ['region','stage','field','goal'].forEach(k=>{
    const el=document.getElementById('p_'+k);
    if(el) el.value=profile[k]||el.value;
  });
}

function saveProfile(){
  profile={
    region:document.getElementById('p_region').value,
    stage:document.getElementById('p_stage').value,
    field:document.getElementById('p_field').value,
    goal:document.getElementById('p_goal').value,
  };
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
  render();
}

function loadBookmarks(){
  try{
    const arr=JSON.parse(localStorage.getItem(BOOKMARK_KEY)||'[]');
    bookmarks=new Set(Array.isArray(arr)?arr:[]);
  }catch(e){ bookmarks=new Set(); }
}

function saveBookmarks(){
  localStorage.setItem(BOOKMARK_KEY, JSON.stringify([...bookmarks]));
}

function noticeKey(n){ return n.id || n.url || `${sourceLabel(n.source)}-${n.title}`; }

function toggleBookmark(key){
  if(bookmarks.has(key)) bookmarks.delete(key); else bookmarks.add(key);
  saveBookmarks();
  render();
}

function dtag(d){ if(d<=1)return 'd1'; if(d<=3)return 'd3'; if(d<=7)return 'd7'; return ''; }
function dlabel(d){ if(d==null)return 'ë§ˆê°ì •ë³´ì—†ìŒ'; if(d<0)return 'ë§ˆê°ì§€ë‚¨'; return `D-${d}`; }
function fitClass(v){ if(v>=80) return 'fit-hi'; if(v>=60) return 'fit-mid'; return 'fit-low'; }
function fitLabel(v){ if(v>=80) return 'ì§€ê¸ˆ ì‹ ì²­'; if(v>=60) return 'ì¤€ë¹„ í›„ ì‹ ì²­'; return 'ë³´ë¥˜'; }
function extractDeadlineTime(n){
  const cand=[n.deadlineTime,n.deadlineText,n.period,n.title]
    .map(v=>(v||'').toString())
    .join(' | ');

  // 18:00 / 9:30
  let m=cand.match(/(?:^|\D)([01]?\d|2[0-3]):([0-5]\d)(?:\D|$)/);
  if(m) return `${m[1].padStart(2,'0')}:${m[2]}`;

  // 18ì‹œ 00ë¶„ / 18ì‹œ
  m=cand.match(/(?:^|\D)([01]?\d|2[0-3])\s*ì‹œ(?:\s*([0-5]?\d)\s*ë¶„)?/);
  if(m){
    const hh=m[1].padStart(2,'0');
    const mm=(m[2]||'00').padStart(2,'0');
    return `${hh}:${mm}`;
  }
  return '';
}

function deadlineWithTime(n){
  const d=(n.deadline||'').toString().trim();
  if(!d) return '-';
  const t=extractDeadlineTime(n);
  if(t) return `${d} ${t}`;
  return d;
}

function calcScore(n,q){
  const reasons=[];
  let s=0;
  const t=(n.title||'');
  const c=(n.category||'');

  if(typeof n.dday==='number'){
    if(n.dday<=1){s+=50; reasons.push('D-1 ì„ë°•');}
    else if(n.dday<=3){s+=35; reasons.push('D-3 ì„ë°•');}
    else if(n.dday<=7){s+=20; reasons.push('D-7 ì„ë°•');}
  }

  if(q && (t.toLowerCase().includes(q) || c.toLowerCase().includes(q))){s+=20; reasons.push('ê²€ìƒ‰ í‚¤ì›Œë“œ ì¼ì¹˜');}

  if(profile.region!=='all' && t.includes(profile.region)){s+=20; reasons.push('ì§€ì—­ ì¼ì¹˜');}

  if(profile.stage!=='all'){
    if(profile.stage==='ì˜ˆë¹„' && /ì˜ˆë¹„/.test(t)){s+=25; reasons.push('ì—…ë ¥(ì˜ˆë¹„) ì¼ì¹˜');}
    if(profile.stage==='ì´ˆê¸°' && /ì´ˆê¸°|ì²­ë…„ì°½ì—…ì‚¬ê´€|ì°½ì—…ì„±ê³µíŒ¨í‚¤ì§€/.test(t)){s+=25; reasons.push('ì—…ë ¥(ì´ˆê¸°) ì¼ì¹˜');}
    if(profile.stage==='ë„ì•½' && /ë„ì•½|ìŠ¤ì¼€ì¼|ì„±ì¥/.test(t)){s+=25; reasons.push('ì—…ë ¥(ë„ì•½) ì¼ì¹˜');}
  }

  if(profile.field!=='all' && (t.includes(profile.field)||c.includes(profile.field))){s+=20; reasons.push('ê´€ì‹¬ë¶„ì•¼ ì¼ì¹˜');}

  if(profile.goal!=='all'){
    if(profile.goal==='ì§€ì›ê¸ˆ' && /ì§€ì›|ë³´ì „|ìê¸ˆ|ìœµì/.test(t)){s+=10; reasons.push('ëª©í‘œ(ì§€ì›ê¸ˆ) ì¼ì¹˜');}
    if(profile.goal==='íŒë¡œ' && /ìˆ˜ì¶œ|ë‚´ìˆ˜|íŒë¡œ|ì „ì‹œ|ë°•ëŒ/.test(t)){s+=10; reasons.push('ëª©í‘œ(íŒë¡œ) ì¼ì¹˜');}
    if(profile.goal==='íˆ¬ì' && /íˆ¬ì|tips|íŒìŠ¤|ir/.test(t.toLowerCase())){s+=10; reasons.push('ëª©í‘œ(íˆ¬ì) ì¼ì¹˜');}
  }

  return {fit:Math.min(100,s), reasons:reasons.slice(0,3)};
}

function makeTodo(list){
  const top=list.filter(x=>x.fit>=60).slice(0,3);
  const todo=[];
  if(top[0]) todo.push(`1) ${top[0].title.slice(0,30)}... ìê²©ìš”ê±´/í•„ìˆ˜ì„œë¥˜ ë¨¼ì € í™•ì¸`);
  if(top[1]) todo.push(`2) ${top[1].title.slice(0,30)}... ì ‘ìˆ˜ ë§ˆê° ì‹œê°„ ì „ ì œì¶œ ë¦¬í—ˆì„¤`);
  todo.push('3) ë§ì¶¤ì ìˆ˜ 80ì  ì´ìƒ 1ê±´ì€ ì˜¤ëŠ˜ ë°”ë¡œ ì‹ ì²­ ì‹œì‘');
  return todo;
}

function render(){
  const q=document.getElementById('q').value.trim().toLowerCase();
  const s=document.getElementById('source').value;
  const d=document.getElementById('dd').value;
  const region=document.getElementById('region').value;
  const viewMode=document.getElementById('viewMode').value;

  let list=RAW.filter(n=>s==='all'||n.source===s)
    .filter(n=>typeof n.dday !== 'number' || n.dday >= 0)
    .filter(n=>(n.title||'').toLowerCase().includes(q))
    .filter(n=>region==='all'||(n.title||'').includes(region));

  if(d!=='all'){
    const lim=Number(d);
    list=list.filter(n=>typeof n.dday==='number' && n.dday>=0 && n.dday<=lim);
  }

  list=list.map(n=>{
    const sc=calcScore(n,q);
    const key=noticeKey(n);
    return {...n, _key:key, fit:sc.fit, reasons:sc.reasons, bookmarked: bookmarks.has(key)};
  });

  if(viewMode==='bookmarked') list=list.filter(n=>n.bookmarked);

  list.sort((a,b)=>b.fit-a.fit || ((a.dday??999)-(b.dday??999)));

  document.getElementById('todoList').innerHTML = makeTodo(list).map(x=>`<li>${x}</li>`).join('');

  document.getElementById('cards').innerHTML = list.slice(0,60).map(n=>`
    <article class="card">
      <div class="row">
        <span class="tag">${sourceLabel(n.source)}</span>
        <span class="tag ${dtag(n.dday)}">${dlabel(n.dday)}</span>
      </div>
      <h3 style="font-size:16px;line-height:1.4;margin:8px 0">${n.title}</h3>
      <div class="small">ë¶„ë¥˜: ${n.category||'-'} Â· ë§ˆê°: ${deadlineWithTime(n)}</div>
      <div class="small">ì§€ì›ê¸ˆ: ${n.supportAmount||'í™•ì¸ í•„ìš”'}</div>
      <div class="reasons">${(n.reasons||[]).map(r=>`<span class='reason'>${r}</span>`).join('')}</div>
      <div class="row" style="margin-top:8px">
        <span class="tag ${fitClass(n.fit)}">ë§ì¶¤ì ìˆ˜ ${n.fit} Â· ${fitLabel(n.fit)}</span>
        <button class="btn-lite bookbtn ${n.bookmarked?'on':''}" onclick="toggleBookmark('${n._key.replace(/'/g,"\\'")}')">${n.bookmarked?'â˜… ë¶ë§ˆí¬ í•´ì œ':'â˜† ë¶ë§ˆí¬ ì €ì¥'}</button>
      </div>
      <div class="row" style="margin-top:8px;justify-content:flex-end">
        <a href="${n.url}" target="_blank">ì›ë¬¸ ë³´ê¸°</a>
      </div>
    </article>
  `).join('');
}

initData();
loadProfile();
loadBookmarks();
render();
</script>
</body>
</html>
