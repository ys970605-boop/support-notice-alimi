<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Food Conquest | ë¹„ì¦ˆë‹ˆìŠ¤ ì—ë””ì…˜</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --china: #ff4d4f; --taiwan: #1890ff; --japan: #ffffff; --korea: #52c41a;
            --dark: #0f172a; --gold: #fbbf24; --accent: #f43f5e;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background: var(--dark); overflow: hidden; color: white; }
        
        /* ìƒë‹¨ ì „í™©íŒ */
        #scoreboard {
            position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000;
            background: rgba(15, 23, 42, 0.9); border: 2px solid #334155;
            border-radius: 15px; padding: 12px; display: flex; justify-content: space-around;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .score-item { text-align: center; }
        .score-item .flag { font-size: 24px; display: block; }
        .score-item .val { font-weight: 900; font-size: 16px; color: var(--gold); }

        /* ê¸´ê¸‰ ë¯¸ì…˜ ì•Œë¦¼ */
        #mission-alert {
            position: absolute; top: 90px; left: 50%; transform: translateX(-50%); z-index: 1000;
            background: var(--accent); color: white; padding: 8px 20px; border-radius: 30px;
            font-size: 13px; font-weight: bold; box-shadow: 0 4px 15px rgba(244,63,94,0.4);
            animation: slideDown 0.5s ease-out, pulse 1.5s infinite;
            display: none; white-space: nowrap;
        }
        @keyframes slideDown { from { top: -50px; } to { top: 90px; } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        /* ì§€ê°‘ */
        #wallet {
            position: absolute; top: 140px; right: 15px; z-index: 1000;
            background: #10b981; color: white; padding: 8px 15px; border-radius: 12px;
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid #34d399;
        }

        #map { width: 100%; height: 100%; z-index: 1; }

        /* ë°”í…€ ì‹œíŠ¸ */
        #capture-panel {
            position: absolute; bottom: -100%; left: 0; right: 0; z-index: 2000;
            background: #ffffff; border-top: 6px solid var(--gold); border-radius: 30px 30px 0 0;
            padding: 25px; transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 -15px 50px rgba(0,0,0,0.2);
            color: #1e293b;
        }
        #capture-panel.open { bottom: 0; }
        
        /* ì»¤ìŠ¤í…€ í•€ ìŠ¤íƒ€ì¼ */
        .marker-pin {
            width: 45px; height: 45px; border-radius: 50% 50% 50% 0; background: white;
            position: absolute; transform: rotate(-45deg); left: 50%; top: 50%; margin: -22px 0 0 -22px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid #334155;
        }
        .marker-pin span { transform: rotate(45deg); font-size: 24px; }
        .marker-pin.bounty { background: var(--gold); border-color: white; animation: pulseGold 1s infinite; }
        @keyframes pulseGold { 0% { box-shadow: 0 0 0 0 rgba(251,191,36,0.7); } 70% { box-shadow: 0 0 0 15px rgba(251,191,36,0); } 100% { box-shadow: 0 0 0 0 rgba(251,191,36,0); } }
        .bounty-badge { background: var(--gold); color: #000; padding: 4px 10px; border-radius: 5px; font-weight: 900; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        .res-name { font-size: 26px; font-weight: 900; margin: 0; color: white; }
        .owner-msg { font-style: italic; color: #94a3b8; margin: 10px 0; font-size: 14px; border-left: 3px solid var(--gold); padding-left: 10px; }

        .btn-capture {
            width: 100%; padding: 18px; border: none; border-radius: 15px;
            background: var(--gold); color: #000; font-size: 20px; font-weight: 900;
            cursor: pointer; margin-top: 20px; box-shadow: 0 5px 15px rgba(251,191,36,0.3);
        }
        .btn-capture:active { transform: scale(0.95); }

        /* í˜„ìƒê¸ˆ í•€ ì´í™íŠ¸ */
        .bounty-marker {
            background: var(--gold); border: 3px solid white; border-radius: 50%;
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            font-size: 22px; box-shadow: 0 0 20px var(--gold); animation: markerPulse 1s infinite;
        }
        @keyframes markerPulse { 0% { transform: scale(1); box-shadow: 0 0 10px var(--gold); } 50% { transform: scale(1.2); box-shadow: 0 0 30px var(--gold); } 100% { transform: scale(1); box-shadow: 0 0 10px var(--gold); } }
    </style>
</head>
<body>

    <div id="scoreboard">
        <div class="score-item"><span class="flag">ğŸ‡¨ğŸ‡³</span><span class="val">42%</span></div>
        <div class="score-item" style="border-left: 1px solid #334155; border-right: 1px solid #334155; padding: 0 30px;"><span class="flag">ğŸ‡°ğŸ‡·</span><span class="val">28%</span></div>
        <div class="score-item"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span class="val">30%</span></div>
    </div>

    <div id="mission-alert">ğŸš¨ ê¸´ê¸‰ íƒˆí™˜ í˜„ìƒê¸ˆ ë°œìƒ: [ì„±ìˆ˜ì¡±ë°œ] ì‚¬ë ¹ë¶€</div>

    <div id="wallet">ğŸ’³ â‚© <span id="cash-val">1,500</span></div>

    <div id="map"></div>

    <div id="capture-panel">
        <div id="bounty-info" class="bounty-badge">ğŸ’° ì‚¬ì¥ë‹˜ì˜ í˜„ìƒê¸ˆ: +â‚© 1,000</div>
        <h2 id="p-name" class="res-name">ì‹ë‹¹ ì´ë¦„</h2>
        <p id="p-owner-msg" class="owner-msg">"ì êµ°ì—ê²Œ ëºê¸´ ìš°ë¦¬ ì‹ë‹¹ì„ ì°¾ì•„ì£¼ì„¸ìš”!"</p>
        
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 15px;">
            <div style="font-size: 12px; color: #94a3b8; margin-bottom: 5px;">í˜„ì¬ ì ìœ  êµ­ê°€</div>
            <div id="p-current-owner" style="font-size: 18px; font-weight: bold;">ğŸ‡¨ğŸ‡³ ì¤‘êµ­ ì‚¬ë ¹ë¶€</div>
        </div>

        <button class="btn-capture" onclick="startCapture()">
            ğŸš© íƒˆí™˜ ì‘ì „ ê°œì‹œ
        </button>
    </div>

    <script>
        let myCash = 1500;
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([37.5445, 127.0560], 16);
        
        // ë°ê³  ì„ ëª…í•œ ì£¼ê°„ ì§€ë„ (Voyager)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        const spots = [
            { id: 1, name: "ì„±ìˆ˜ì¡±ë°œ", lat: 37.5446, lng: 127.0565, owner: "ğŸ‡¨ğŸ‡³", bounty: 1000, msg: "ì¤„ ì„œì„œ ê¸°ë‹¤ë¦¬ëŠ” ìš°ë¦¬ ì†ë‹˜ë“¤ì´ ë¶ˆì•ˆí•´í•©ë‹ˆë‹¤. ì œë°œ ë„ì™€ì£¼ì„¸ìš”!" },
            { id: 2, name: "ì–´ë‹ˆì–¸ ì„±ìˆ˜", lat: 37.5440, lng: 127.0580, owner: "ğŸ‡¯ğŸ‡µ", bounty: 500, msg: "ì¼ë³¸êµ°ì´ ì¹´í˜ë¥¼ ì ë ¹í•´ ì»¤í”¼ ë§›ì´ ë³€í–ˆìŠµë‹ˆë‹¤!" },
            { id: 3, name: "ì†Œë¬¸ë‚œì„±ìˆ˜ê°ìíƒ•", lat: 37.5428, lng: 127.0560, owner: "ğŸ‡°ğŸ‡·", bounty: 0, msg: "" },
            { id: 4, name: "ë¸”ë£¨ë³´í‹€ ì„±ìˆ˜", lat: 37.5478, lng: 127.0440, owner: "ğŸ‡¨ğŸ‡³", bounty: 800, msg: "ê¸€ë¡œë²Œ ë¸Œëœë“œì˜ ìì¡´ì‹¬ì„ ì°¾ì•„ì£¼ì„¸ìš”!" }
        ];

        let selectedSpot = null;
        const markers = {};

        spots.forEach(spot => {
            updateMarker(spot);
        });

        function updateMarker(spot) {
            const isBounty = spot.bounty > 0;
            const icon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="marker-pin ${isBounty ? 'bounty' : ''}"><span>${isBounty ? 'ğŸ’°' : spot.owner}</span></div>`,
                iconSize: [45, 45],
                iconAnchor: [22, 45]
            });

            if (markers[spot.id]) {
                markers[spot.id].setIcon(icon);
            } else {
                const marker = L.marker([spot.lat, spot.lng], { icon: icon }).addTo(map);
                markers[spot.id] = marker;
                marker.on('click', () => {
                    selectedSpot = spot;
                    openPanel(spot);
                });
            }
        }

        function openPanel(spot) {
            document.getElementById('p-name').innerText = spot.name;
            document.getElementById('p-owner-msg').innerText = spot.msg || "ì´ ì§€ì—­ì„ ì ë ¹í•˜ì—¬ ì¡°êµ­ì˜ ì˜ê´‘ì„ ë†’ì´ì„¸ìš”!";
            document.getElementById('p-current-owner').innerText = `${spot.owner} ì‚¬ë ¹ë¶€`;
            
            const bInfo = document.getElementById('bounty-info');
            if(spot.bounty > 0) {
                bInfo.style.display = 'inline-block';
                bInfo.innerText = `ğŸ’° ì‚¬ì¥ë‹˜ì˜ íŠ¹ë³„ í˜„ìƒê¸ˆ: +â‚© ${spot.bounty.toLocaleString()}`;
            } else {
                bInfo.style.display = 'none';
            }

            document.getElementById('capture-panel').classList.add('open');
        }

        function startCapture() {
            if(!selectedSpot) return;
            const btn = document.querySelector('.btn-capture');
            btn.innerText = "â³ ì˜ìˆ˜ì¦ ìœ„ì¹˜ ë°ì´í„° ë§¤ì¹­ ì¤‘...";
            btn.style.background = "#94a3b8";

            setTimeout(() => {
                const totalGain = 500 + selectedSpot.bounty;
                myCash += totalGain;
                document.getElementById('cash-val').innerText = myCash.toLocaleString();
                
                alert(`ğŸ¯ íƒˆí™˜ ì„±ê³µ!\n[${selectedSpot.name}] ì‚¬ì¥ë‹˜ì´ ì•½ì†í•œ í˜„ìƒê¸ˆê³¼ ì •ë³µ ë³´ìƒ í¬í•¨ ì´ â‚©${totalGain.toLocaleString()}ì›ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                
                // í•€ ì—…ë°ì´íŠ¸
                selectedSpot.owner = "ğŸ‡°ğŸ‡·";
                selectedSpot.bounty = 0;
                const newIcon = L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="font-size:30px;">ğŸ‡°ğŸ‡·</div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });
                markers[selectedSpot.id].setIcon(newIcon);
                
                document.getElementById('capture-panel').classList.remove('open');
                btn.innerText = "ğŸš© íƒˆí™˜ ì‘ì „ ê°œì‹œ";
                btn.style.background = "var(--gold)";
            }, 2000);
        }

        // ì´ˆê¸° ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        setTimeout(() => {
            const alert = document.getElementById('mission-alert');
            alert.style.display = 'block';
            setTimeout(() => { alert.style.display = 'none'; }, 5000);
        }, 3000);
    </script>
</body>
</html>
