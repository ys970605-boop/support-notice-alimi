<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Food Conquest | ë§›ì§‘ ì˜í†  ì „ìŸ</title>
    <!-- ì§€ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --china: #ff4d4f;
            --taiwan: #1890ff;
            --japan: #ffffff;
            --korea: #52c41a;
            --dark: #1a1a2e;
            --gold: #fadb14;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--dark); overflow: hidden; }
        
        /* ìƒë‹¨ ì „í™©íŒ */
        #scoreboard {
            position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000;
            background: rgba(26, 26, 46, 0.9); border: 2px solid var(--gold);
            border-radius: 15px; padding: 10px; display: flex; justify-content: space-around;
            color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .score-item { text-align: center; }
        .score-item .flag { font-size: 20px; display: block; }
        .score-item .val { font-weight: bold; font-size: 14px; color: var(--gold); }
        .score-item .label { font-size: 10px; opacity: 0.8; }

        /* ì§€ë„ ì˜ì—­ */
        #map { width: 100%; height: 100%; z-index: 1; }

        /* í•˜ë‹¨ ì ë ¹ íŒ¨ë„ (Bottom Sheet) */
        #capture-panel {
            position: absolute; bottom: -100%; left: 0; right: 0; z-index: 2000;
            background: white; border-top-left-radius: 25px; border-top-right-radius: 25px;
            padding: 20px; transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
        }
        #capture-panel.open { bottom: 0; }
        .panel-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .res-name { font-size: 22px; font-weight: 900; color: var(--dark); margin: 0; }
        .res-addr { font-size: 13px; color: #666; margin: 4px 0; }
        
        /* ë³„ì  ì‹œìŠ¤í…œ */
        .rating-box { margin: 15px 0; border-top: 1px solid #eee; padding-top: 15px; }
        .rating-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .rating-label { font-weight: bold; font-size: 15px; color: var(--dark); }
        .stars { color: #ddd; font-size: 20px; letter-spacing: 5px; cursor: pointer; }
        .stars.active { color: var(--gold); }

        /* ì ë ¹ ë²„íŠ¼ */
        .btn-capture {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: var(--dark); color: white; font-size: 18px; font-weight: bold;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .btn-capture:active { transform: scale(0.98); }
        .reward-info { text-align: center; margin-top: 10px; font-size: 12px; color: #ff4d4f; font-weight: bold; }

        /* ê¹ƒë°œ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .flag-icon {
            background: white; border: 2px solid var(--dark); border-radius: 50%;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
            font-size: 18px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

    <div id="scoreboard">
        <div class="score-item">
            <span class="flag">ğŸ‡¨ğŸ‡³</span>
            <span class="val" id="score-cn">42%</span>
            <span class="label">ì¤‘êµ­</span>
        </div>
        <div class="score-item" style="border-left: 1px solid #444; border-right: 1px solid #444; padding: 0 20px;">
            <span class="flag">ğŸ‡°ğŸ‡·</span>
            <span class="val" id="score-kr">28%</span>
            <span class="label">ëŒ€í•œë¯¼êµ­</span>
        </div>
        <div class="score-item">
            <span class="flag">ğŸ‡¹ğŸ‡¼</span>
            <span class="val" id="score-tw">15%</span>
            <span class="label">ëŒ€ë§Œ</span>
        </div>
        <div class="score-item">
            <span class="flag">ğŸ‡¯ğŸ‡µ</span>
            <span class="val" id="score-jp">15%</span>
            <span class="label">ì¼ë³¸</span>
        </div>
    </div>

    <div id="map"></div>

    <div id="capture-panel">
        <div class="panel-header">
            <div>
                <h2 id="p-name" class="res-name">ì‹ë‹¹ ì´ë¦„</h2>
                <p id="p-addr" class="res-addr">ì£¼ì†Œ ì •ë³´ê°€ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...</p>
                <span id="p-owner" style="font-size: 11px; background: #eee; padding: 2px 6px; border-radius: 4px;">í˜„ì¬ ì ë ¹êµ­: ğŸ‡¨ğŸ‡³ ì¤‘êµ­</span>
            </div>
            <button onclick="closePanel()" style="background:none; border:none; font-size:24px;">Ã—</button>
        </div>

        <div class="rating-box">
            <div class="rating-row">
                <span class="rating-label">ë§› (Taste)</span>
                <div class="stars" onclick="setStar(this)">â˜…â˜…â˜…â˜…â˜…</div>
            </div>
            <div class="rating-row">
                <span class="rating-label">ìœ„ìƒ (Hygiene)</span>
                <div class="stars" onclick="setStar(this)">â˜…â˜…â˜…â˜…â˜…</div>
            </div>
            <div class="rating-row">
                <span class="rating-label">ì„œë¹„ìŠ¤ (Service)</span>
                <div class="stars" onclick="setStar(this)">â˜…â˜…â˜…â˜…â˜…</div>
            </div>
        </div>

        <button class="btn-capture" onclick="captureAction()">
            ğŸš© ë‚´ ì¡°êµ­ì˜ ê¹ƒë°œ ê½‚ê¸°
        </button>
        <p class="reward-info">ğŸ’° ì •ë³µ ì„±ê³µ ì‹œ 500ì› ì¦‰ì‹œ ì ë¦½ (KRW)</p>
    </div>

    <script>
        // ì§€ë„ ì´ˆê¸°í™” (ì„œìš¸ ì„±ìˆ˜ë™ ì¤‘ì‹¬)
        const map = L.map('map', { zoomControl: false }).setView([37.5445, 127.0560], 16);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° (ì„±ìˆ˜ë™ ë§›ì§‘ ê±°ì )
        const spots = [
            { id: 1, name: "ì„±ìˆ˜ì¡±ë°œ", addr: "ì„±ìˆ˜ë™2ê°€ 302-1", lat: 37.5446, lng: 127.0565, owner: "ğŸ‡¨ğŸ‡³", color: "#ff4d4f" },
            { id: 2, name: "ì–´ë‹ˆì–¸ ì„±ìˆ˜", addr: "ì„±ìˆ˜ë™2ê°€ 277-7", lat: 37.5440, lng: 127.0580, owner: "ğŸ‡¯ğŸ‡µ", color: "#ffffff" },
            { id: 3, name: "ì†Œë¬¸ë‚œì„±ìˆ˜ê°ìíƒ•", addr: "ì„±ìˆ˜ë™2ê°€ 315-100", lat: 37.5428, lng: 127.0560, owner: "ğŸ‡°ğŸ‡·", color: "#52c41a" },
            { id: 4, name: "ëŒ€ì„±ê°ˆë¹„", addr: "ì„±ìˆ˜ë™1ê°€ 668-21", lat: 37.5470, lng: 127.0430, owner: "ğŸ‡¹ğŸ‡¼", color: "#1890ff" },
            { id: 5, name: "ë¸”ë£¨ë³´í‹€ ì„±ìˆ˜", addr: "ì„±ìˆ˜ë™1ê°€ 656-302", lat: 37.5478, lng: 127.0440, owner: "ğŸ‡¨ğŸ‡³", color: "#ff4d4f" }
        ];

        let selectedSpot = null;
        const markers = {};

        // ë§ˆì»¤ ìƒì„± ë° ë§µ í‘œì‹œ
        spots.forEach(spot => {
            const icon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="flag-icon" style="border-color:${spot.color}">${spot.owner}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            const marker = L.marker([spot.lat, spot.lng], { icon: icon }).addTo(map);
            markers[spot.id] = marker;

            marker.on('click', () => {
                selectedSpot = spot;
                openPanel(spot);
            });
        });

        function openPanel(spot) {
            document.getElementById('p-name').innerText = spot.name;
            document.getElementById('p-addr').innerText = spot.addr;
            document.getElementById('p-owner').innerText = `í˜„ì¬ ì ë ¹êµ­: ${spot.owner} ì‚¬ë ¹ë¶€`;
            document.getElementById('capture-panel').classList.add('open');
            
            // ë³„ì  ì´ˆê¸°í™”
            document.querySelectorAll('.stars').forEach(s => s.classList.remove('active'));
        }

        function closePanel() {
            document.getElementById('capture-panel').classList.remove('open');
        }

        function setStar(el) {
            el.classList.add('active');
            el.innerText = "â˜…â˜…â˜…â˜…â˜…"; // ì‹œë®¬ë ˆì´ì…˜ìš©
        }

        function captureAction() {
            if(!selectedSpot) return;
            
            // ì ë ¹ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            const btn = document.querySelector('.btn-capture');
            btn.innerHTML = "â³ ì ë ¹ ì¤‘ (ì˜ìˆ˜ì¦ ê²€ì¦)...";
            btn.style.background = "#52c41a";

            setTimeout(() => {
                alert(`ğŸš€ ì •ë³µ ì„±ê³µ! ${selectedSpot.name}ì— ë‹¹ì‹ ì˜ ê¹ƒë°œì„ ê½‚ì•˜ìŠµë‹ˆë‹¤! 500ì›ì´ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ë§ˆì»¤ êµ­ê¸° ë³€ê²½ (ë‚´ êµ­ê¸°ë¡œ ê°€ì •: ì—¬ê¸°ì„  í•œêµ­ ğŸ‡°ğŸ‡·ë¡œ í…ŒìŠ¤íŠ¸)
                selectedSpot.owner = "ğŸ‡°ğŸ‡·";
                selectedSpot.color = "#52c41a";
                
                const newIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="flag-icon" style="border-color:${selectedSpot.color}">${selectedSpot.owner}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                markers[selectedSpot.id].setIcon(newIcon);
                
                // ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                document.getElementById('score-kr').innerText = "32%";
                document.getElementById('score-cn').innerText = "40%";
                
                btn.innerHTML = "ğŸš© ë‚´ ì¡°êµ­ì˜ ê¹ƒë°œ ê½‚ê¸°";
                btn.style.background = "#1a1a2e";
                closePanel();
            }, 1500);
        }
    </script>
</body>
</html>
