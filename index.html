<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Food Conquest | ë¹„ì¦ˆë‹ˆìŠ¤ ì—ë””ì…˜</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --china: #ff4d4f; --taiwan: #1890ff; --japan: #ffffff; --korea: #52c41a;
            --dark: #0f172a; --gold: #fbbf24; --accent: #f43f5e;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background: var(--dark); overflow: hidden; color: white; }
        
        /* ìƒë‹¨ ì „í™©íŒ */
        #scoreboard {
            position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000;
            background: rgba(15, 23, 42, 0.9); border: 2px solid #334155;
            border-radius: 15px; padding: 12px; display: flex; justify-content: space-around;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .score-item { text-align: center; }
        .score-item .flag { font-size: 24px; display: block; }
        .score-item .val { font-weight: 900; font-size: 16px; color: var(--gold); }

        /* ê¸´ê¸‰ ë¯¸ì…˜ ì•Œë¦¼ */
        #mission-alert {
            position: absolute; top: 90px; left: 50%; transform: translateX(-50%); z-index: 1000;
            background: var(--accent); color: white; padding: 8px 20px; border-radius: 30px;
            font-size: 13px; font-weight: bold; box-shadow: 0 4px 15px rgba(244,63,94,0.4);
            animation: slideDown 0.5s ease-out, pulse 1.5s infinite;
            display: none; white-space: nowrap;
        }
        @keyframes slideDown { from { top: -50px; } to { top: 90px; } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        /* ì§€ê°‘ */
        #wallet {
            position: absolute; top: 140px; right: 15px; z-index: 1000;
            background: #10b981; color: white; padding: 8px 15px; border-radius: 12px;
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid #34d399;
        }

        #map { width: 100%; height: 100%; z-index: 1; }

        /* ë°”í…€ ì‹œíŠ¸ */
        #capture-panel {
            position: absolute; bottom: -100%; left: 0; right: 0; z-index: 2000;
            background: #ffffff; border-top: 6px solid var(--gold); border-radius: 30px 30px 0 0;
            padding: 25px; transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 -15px 50px rgba(0,0,0,0.2);
            color: #1e293b;
        }
        #capture-panel.open { bottom: 0; }
        
        /* ì»¤ìŠ¤í…€ í•€ ìŠ¤íƒ€ì¼ */
        .marker-pin {
            width: 45px; height: 45px; border-radius: 50% 50% 50% 0; background: white;
            position: absolute; transform: rotate(-45deg); left: 50%; top: 50%; margin: -22px 0 0 -22px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid #334155;
        }
        .marker-pin span { transform: rotate(45deg); font-size: 24px; }
        .marker-pin.bounty { background: var(--gold); border-color: white; animation: pulseGold 1s infinite; }
        .marker-pin.top-rank::after {
            content: 'ğŸ‘‘'; position: absolute; top: -25px; left: 5px; transform: rotate(45deg);
            font-size: 25px; filter: drop-shadow(0 0 5px gold); animation: float 1s infinite alternate;
        }
        @keyframes float { from { top: -25px; } to { top: -35px; } }
        @keyframes pulseGold { 0% { box-shadow: 0 0 0 0 rgba(251,191,36,0.7); } 70% { box-shadow: 0 0 0 15px rgba(251,191,36,0); } 100% { box-shadow: 0 0 0 0 rgba(251,191,36,0); } }

        /* ìŒì‹ ì‚¬ì§„ ìŠ¤íƒ€ì¼ */
        .res-photo {
            width: 100%; height: 150px; border-radius: 15px; object-fit: cover;
            margin-bottom: 15px; border: 2px solid #eee;
        }
        .bounty-badge { background: var(--gold); color: #000; padding: 4px 10px; border-radius: 5px; font-weight: 900; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        .res-name { font-size: 26px; font-weight: 900; margin: 0; color: white; }
        .owner-msg { font-style: italic; color: #94a3b8; margin: 10px 0; font-size: 14px; border-left: 3px solid var(--gold); padding-left: 10px; }

        .btn-capture {
            width: 100%; padding: 18px; border: none; border-radius: 15px;
            background: var(--gold); color: #000; font-size: 20px; font-weight: 900;
            cursor: pointer; margin-top: 20px; box-shadow: 0 5px 15px rgba(251,191,36,0.3);
        }
        .btn-capture:active { transform: scale(0.95); }

        /* í˜„ìƒê¸ˆ í•€ ì´í™íŠ¸ */
        .bounty-marker {
            background: var(--gold); border: 3px solid white; border-radius: 50%;
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            font-size: 22px; box-shadow: 0 0 20px var(--gold); animation: markerPulse 1s infinite;
        }
        @keyframes markerPulse { 0% { transform: scale(1); box-shadow: 0 0 10px var(--gold); } 50% { transform: scale(1.2); box-shadow: 0 0 30px var(--gold); } 100% { transform: scale(1); box-shadow: 0 0 10px var(--gold); } }
    </style>
</head>
<body>

    <div id="scoreboard">
        <div class="score-item"><span class="flag">ğŸ‡¨ğŸ‡³</span><span class="val">42%</span></div>
        <div class="score-item" style="border-left: 1px solid #334155; border-right: 1px solid #334155; padding: 0 30px;"><span class="flag">ğŸ‡°ğŸ‡·</span><span class="val">28%</span></div>
        <div class="score-item"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span class="val">30%</span></div>
    </div>

    <div id="mission-alert">ğŸš¨ ê¸´ê¸‰ íƒˆí™˜ í˜„ìƒê¸ˆ ë°œìƒ: [ì„±ìˆ˜ì¡±ë°œ] ì‚¬ë ¹ë¶€</div>

    <div id="wallet">ğŸ’³ â‚© <span id="cash-val">1,500</span></div>

    <!-- ì „ìˆ  ìƒì  -->
    <div id="shop-trigger" onclick="toggleShop()" style="position: absolute; top: 190px; right: 15px; z-index: 1000; background: #3b82f6; color: white; padding: 10px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">ğŸ›’</div>
    
    <!-- ë¹„ë°€ ì „ëµì‹¤ ë²„íŠ¼ -->
    <div id="chat-trigger" onclick="toggleChat()" style="position: absolute; top: 190px; left: 15px; z-index: 1000; background: var(--accent); color: white; padding: 10px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">ğŸ’¬</div>

    <!-- AI ìŠ¤ìº” ì˜¤ë²„ë ˆì´ -->
    <div id="scan-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; color: #00ff00; font-family: monospace;">
        <div style="width: 250px; height: 350px; border: 2px solid #00ff00; position: relative; overflow: hidden; margin-bottom: 20px;">
            <div id="scan-line" style="position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: #00ff00; box-shadow: 0 0 15px #00ff00; animation: scanAnim 2s infinite;"></div>
            <div id="scan-logs" style="padding: 10px; font-size: 10px; color: #00ff00;"></div>
        </div>
        <b style="font-size: 18px; letter-spacing: 2px;">AI RECEIPT ANALYZING...</b>
        <div id="scan-progress" style="width: 200px; height: 4px; background: #111; margin-top: 15px; border-radius: 2px; overflow: hidden;">
            <div id="scan-bar" style="width: 0%; height: 100%; background: #00ff00; transition: width 0.1s;"></div>
        </div>
    </div>

    <!-- ë¹„ë°€ ì „ëµì‹¤ (ì±„íŒ…ì°½) -->
    <div id="chat-panel" style="position: absolute; top: 240px; left: 15px; z-index: 1000; background: rgba(15, 23, 42, 0.95); padding: 15px; border-radius: 12px; width: 220px; height: 300px; display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid var(--accent);">
        <b style="font-size: 14px; color: var(--accent); margin-bottom: 10px; display: block;">ğŸ‡°ğŸ‡· í•œêµ­êµ° ë¹„ë°€ ì „ëµì‹¤</b>
        <div id="chat-messages" style="flex-grow: 1; overflow-y: auto; font-size: 12px; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 10px;">
            <div style="color: #94a3b8; font-style: italic; margin-bottom: 5px;">[ì‹œìŠ¤í…œ] ì „ìš°ë“¤ê³¼ ì „ëµì„ ê³µìœ í•˜ì„¸ìš”.</div>
            <div style="margin-bottom: 5px;"><b>ë¯¸ì‹ëŒ€ì¥:</b> ì„±ìˆ˜ì¡±ë°œ íƒˆí™˜í•˜ëŸ¬ ê°‘ë‹ˆë‹¤!</div>
            <div style="margin-bottom: 5px;"><b>ì„œìš¸ì •ë³µì:</b> 2ì‹œ ë°©í–¥ì— ì¤‘êµ­íŒ€ ì§‘ê²° ì¤‘ ì¡°ì‹¬ìš”</div>
        </div>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." style="flex-grow: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 5px; border-radius: 4px; font-size: 11px;">
            <button onclick="sendChatMessage()" style="background: var(--accent); color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì „ì†¡</button>
        </div>
    </div>
        <b style="font-size: 14px; display: block; margin-bottom: 10px;">ì „ìˆ  ìƒì </b>
        <div style="background: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
            <div style="font-size: 12px; font-weight: bold;">â„ï¸ ì–¼ìŒ í­í’</div>
            <div style="font-size: 10px; color: #64748b;">10ë¶„ê°„ íƒ€êµ­ í™œë™ ì¤‘ë‹¨</div>
            <button onclick="buyItem('freeze')" style="width: 100%; margin-top: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; padding: 5px; font-size: 11px; cursor: pointer;">â‚© 2,000 êµ¬ë§¤</button>
        </div>
        <button onclick="shareKakao()" style="width: 100%; background: #fee500; color: #3c1e1e; border: none; border-radius: 8px; padding: 10px; font-weight: bold; font-size: 12px; cursor: pointer;">ğŸ¤ ì§€ì›êµ° ìš”ì²­í•˜ê¸°</button>
    </div>

    <!-- ë®¤ì§ í”Œë ˆì´ì–´ ìœ„ì ¯ -->
    <div id="music-player" style="position: absolute; bottom: 85px; left: 15px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; gap: 10px; border: 1px solid var(--gold);">
        <span id="music-icon">ğŸµ</span>
        <marquee id="music-title" style="width: 80px; font-size: 10px; color: var(--gold);">í˜„ì¬ 1ìœ„: ğŸ‡¨ğŸ‡³ ì¤‘êµ­ êµ­ê°€ ì¬ìƒ ì¤‘...</marquee>
        <button onclick="toggleMusic()" style="background: none; border: none; color: white; cursor: pointer; font-size: 12px;">â¸</button>
    </div>

    <!-- ìˆ¨ê²¨ì§„ ì˜¤ë””ì˜¤ ë° ì¹´ë©”ë¼ ì…ë ¥ -->
    <audio id="anthem-audio" loop></audio>
    <input type="file" id="camera-input" accept="image/*" capture="environment" style="display: none;" onchange="handleCameraCapture(this)">

    <div id="map"></div>

    <div id="capture-panel">
        <img id="p-photo" class="res-photo" src="" alt="ìŒì‹ ì‚¬ì§„">
        <div id="bounty-info" class="bounty-badge">ğŸ’° ì‚¬ì¥ë‹˜ì˜ í˜„ìƒê¸ˆ: +â‚© 1,000</div>
        <h2 id="p-name" class="res-name">ì‹ë‹¹ ì´ë¦„</h2>
        <p id="p-owner-msg" class="owner-msg">"ì êµ°ì—ê²Œ ëºê¸´ ìš°ë¦¬ ì‹ë‹¹ì„ ì°¾ì•„ì£¼ì„¸ìš”!"</p>
        
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 15px;">
            <div style="font-size: 12px; color: #94a3b8; margin-bottom: 5px;">í˜„ì¬ ì ìœ  êµ­ê°€</div>
            <div id="p-current-owner" style="font-size: 18px; font-weight: bold;">ğŸ‡¨ğŸ‡³ ì¤‘êµ­ ì‚¬ë ¹ë¶€</div>
        </div>

        <button class="btn-capture" onclick="triggerCamera()">
            ğŸš© íƒˆí™˜ ì‘ì „ ê°œì‹œ (ì¹´ë©”ë¼ ì´¬ì˜)
        </button>
    </div>

    <script>
        // ì£¼ê¸°ì ìœ¼ë¡œ êµ­ê°€(Anthem) ì—…ë°ì´íŠ¸ í™•ì¸
        setInterval(updateAnthem, 5000);
        let myCash = 1500;
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([37.5445, 127.0560], 16);
        
        // ë°ê³  ì„ ëª…í•œ ì£¼ê°„ ì§€ë„ (Voyager)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        const spots = [
            { id: 1, name: "ì„±ìˆ˜ì¡±ë°œ", lat: 37.5446, lng: 127.0565, owner: "ğŸ‡¨ğŸ‡³", bounty: 1000, msg: "ì¤„ ì„œì„œ ê¸°ë‹¤ë¦¬ëŠ” ìš°ë¦¬ ì†ë‹˜ë“¤ì´ ë¶ˆì•ˆí•´í•©ë‹ˆë‹¤. ì œë°œ ë„ì™€ì£¼ì„¸ìš”!", img: "https://images.unsplash.com/photo-1628253747716-0c4f5c90f75c?auto=format&fit=crop&w=400&q=80" },
            { id: 2, name: "ì–´ë‹ˆì–¸ ì„±ìˆ˜", lat: 37.5440, lng: 127.0580, owner: "ğŸ‡¯ğŸ‡µ", bounty: 500, msg: "ì¼ë³¸êµ°ì´ ì¹´í˜ë¥¼ ì ë ¹í•´ ì»¤í”¼ ë§›ì´ ë³€í–ˆìŠµë‹ˆë‹¤!", img: "https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=400&q=80" },
            { id: 3, name: "ì†Œë¬¸ë‚œì„±ìˆ˜ê°ìíƒ•", lat: 37.5428, lng: 127.0560, owner: "ğŸ‡°ğŸ‡·", bounty: 0, msg: "", img: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&w=400&q=80" },
            { id: 4, name: "ë¸”ë£¨ë³´í‹€ ì„±ìˆ˜", lat: 37.5478, lng: 127.0440, owner: "ğŸ‡¨ğŸ‡³", bounty: 800, msg: "ê¸€ë¡œë²Œ ë¸Œëœë“œì˜ ìì¡´ì‹¬ì„ ì°¾ì•„ì£¼ì„¸ìš”!", img: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=400&q=80" }
        ];

        let selectedSpot = null;
        let topNation = "ğŸ‡¨ğŸ‡³";
        let isFrozen = false;
        const markers = {};

        function toggleShop() {
            const panel = document.getElementById('shop-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function buyItem(type) {
            if(myCash < 2000) { alert('ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!'); return; }
            myCash -= 2000;
            document.getElementById('cash-val').innerText = myCash.toLocaleString();
            
            if(type === 'freeze') {
                isFrozen = true;
                document.getElementById('map').style.filter = 'brightness(0.8) saturate(0.5) hue-rotate(180deg)';
                alert('â„ï¸ ì–¼ìŒ í­í’ ë°œë™! 10ë¶„ê°„ íƒ€êµ­ì˜ í™œë™ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.');
                setTimeout(() => {
                    isFrozen = false;
                    document.getElementById('map').style.filter = 'brightness(1) saturate(1) hue-rotate(0deg)';
                }, 10000); // ì‹œë®¬ë ˆì´ì…˜ìƒ 10ì´ˆ í›„ í•´ì œ
            }
            toggleShop();
        }

        function shareKakao() {
            // ì‹¤ì œ ì¹´ì¹´ì˜¤ SDK ì—°ë™ ì „ ì‹œë®¬ë ˆì´ì…˜
            const shareText = "ğŸš¨ ê¸´ê¸‰ ìƒí™©! ì„±ìˆ˜ë™ì´ ì ë ¹ë‹¹í•˜ê³  ìˆë‹¤! ì§€ê¸ˆ ë°”ë¡œ ì§€ì›êµ°ìœ¼ë¡œ í•©ë¥˜í•´ ê¹ƒë°œì„ ê½‚ì•„ì¤˜! \n https://ys970605-boop.github.io/support-notice-alimi/";
            prompt("ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê³µìœ í•  ë©”ì‹œì§€ì…ë‹ˆë‹¤. ë³µì‚¬í•´ì„œ ì¹œêµ¬ì—ê²Œ ë³´ë‚´ì„¸ìš”!", shareText);
        }

        spots.forEach(spot => {
            updateMarker(spot);
        });

        function updateMarker(spot) {
            const isBounty = spot.bounty > 0;
            const isTop = spot.owner === topNation;
            const icon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="marker-pin ${isBounty ? 'bounty' : ''} ${isTop ? 'top-rank' : ''}"><span>${isBounty ? 'ğŸ’°' : spot.owner}</span></div>`,
                iconSize: [45, 45],
                iconAnchor: [22, 45]
            });

            if (markers[spot.id]) {
                markers[spot.id].setIcon(icon);
            } else {
                const marker = L.marker([spot.lat, spot.lng], { icon: icon }).addTo(map);
                markers[spot.id] = marker;
                marker.on('click', () => {
                    selectedSpot = spot;
                    openPanel(spot);
                });
            }
        }

        function openPanel(spot) {
            document.getElementById('p-name').innerText = spot.name;
            document.getElementById('p-photo').src = spot.img;
            document.getElementById('p-owner-msg').innerText = spot.msg || "ì´ ì§€ì—­ì„ ì ë ¹í•˜ì—¬ ì¡°êµ­ì˜ ì˜ê´‘ì„ ë†’ì´ì„¸ìš”!";
            document.getElementById('p-current-owner').innerText = `${spot.owner} ì‚¬ë ¹ë¶€`;
            
            const bInfo = document.getElementById('bounty-info');
            if(spot.bounty > 0) {
                bInfo.style.display = 'inline-block';
                bInfo.innerText = `ğŸ’° ì‚¬ì¥ë‹˜ì˜ íŠ¹ë³„ í˜„ìƒê¸ˆ: +â‚© ${spot.bounty.toLocaleString()}`;
            } else {
                bInfo.style.display = 'none';
            }

            document.getElementById('capture-panel').classList.add('open');
        }

        function toggleChat() {
            const panel = document.getElementById('chat-panel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            if(!input.value) return;
            const msgs = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.style.marginBottom = '5px';
            div.innerHTML = `<b>ë‚˜:</b> ${input.value}`;
            msgs.appendChild(div);
            msgs.scrollTop = msgs.scrollHeight;
            input.value = '';
        }

        const ANTHEMS = {
            "ğŸ‡°ğŸ‡·": { title: "ëŒ€í•œë¯¼êµ­ - ì• êµ­ê°€", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" }, // ìƒ˜í”Œ ì˜¤ë””ì˜¤
            "ğŸ‡¨ğŸ‡³": { title: "ì¤‘êµ­ - ì˜ìš©êµ° ì§„í–‰ê³¡", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            "ğŸ‡¯ğŸ‡µ": { title: "ì¼ë³¸ - ê¸°ë¯¸ê°€ìš”", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
        };

        function updateAnthem() {
            const audio = document.getElementById('anthem-audio');
            const title = document.getElementById('music-title');
            const anthem = ANTHEMS[topNation] || ANTHEMS["ğŸ‡°ğŸ‡·"];
            
            if(audio.src !== anthem.url) {
                audio.src = anthem.url;
                title.innerText = `í˜„ì¬ 1ìœ„: ${anthem.title} ì¬ìƒ ì¤‘...`;
                audio.play().catch(e => console.log("ìë™ ì¬ìƒ ëŒ€ê¸° ì¤‘..."));
            }
        }

        function toggleMusic() {
            const audio = document.getElementById('anthem-audio');
            if(audio.paused) audio.play(); else audio.pause();
        }

        function triggerCamera() {
            if(isFrozen) { alert('â„ï¸ ì˜í† ê°€ ì–¼ì–´ë¶™ì–´ í™œë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!'); return; }
            document.getElementById('camera-input').click();
        }

        function handleCameraCapture(input) {
            if(input.files && input.files[0]) {
                startCapture(); // ì´¬ì˜ ì™„ë£Œ í›„ AI ìŠ¤ìº” ì‹œì‘
            }
        }

        async function startCapture() {
            if(!selectedSpot) return;
            
            // 1. AI ìŠ¤ìº” ì‹œì‘ (ë¡œê·¸ ì¶”ê°€)
            document.getElementById('scan-overlay').style.display = 'flex';
            const logs = document.getElementById('scan-logs');
            const bar = document.getElementById('scan-bar');
            const logSteps = [
                "Camera Stream Captured...",
                "Analyzing Image Lighting...",
                "OCR Engine v4.2 Initialized...",
                "Searching for Merchant: " + selectedSpot.name,
                "Validating Receipt Metadata...",
                "Anti-Fraud Check: Passed",
                "Transaction Match Confirmed",
                "Rewarding Patriot: â‚©" + (500 + selectedSpot.bounty)
            ];

            for(let i=0; i<logSteps.length; i++) {
                const log = document.createElement('div');
                log.innerText = `> ${logSteps[i]}`;
                logs.appendChild(log);
                bar.style.width = ((i+1) / logSteps.length * 100) + '%';
                await new Promise(r => setTimeout(r, 400));
            }

            // 2. ë³´ìƒ ì§€ê¸‰ ë° í•€ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                document.getElementById('scan-overlay').style.display = 'none';
                document.getElementById('scan-logs').innerHTML = '';
                
                const totalGain = 500 + selectedSpot.bounty;
                myCash += totalGain;
                document.getElementById('cash-val').innerText = myCash.toLocaleString();
                
                alert(`ğŸ¯ íƒˆí™˜ ì„±ê³µ!\nAI ì •ë°€ ë¶„ì„ ê²°ê³¼, ì‹¤ì œ ë°©ë¬¸ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.\nâ‚©${totalGain.toLocaleString()}ì›ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                selectedSpot.owner = "ğŸ‡°ğŸ‡·";
                selectedSpot.bounty = 0;
                updateMarker(selectedSpot);
                
                document.getElementById('capture-panel').classList.remove('open');
            }, 500);
        }

        // ì´ˆê¸° ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        setTimeout(() => {
            const alert = document.getElementById('mission-alert');
            alert.style.display = 'block';
            setTimeout(() => { alert.style.display = 'none'; }, 5000);
        }, 3000);
    </script>
</body>
</html>
