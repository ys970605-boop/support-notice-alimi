<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K-Infection .io | ê¸€ë¡œë²Œ ê°ì—¼ ì „ìŸ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #050000; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #ff4d4f; touch-action: none; }
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* ë‰´ìŠ¤ í‹°ì»¤ ìŠ¤íƒ€ì¼ */
        #news-ticker {
            position: absolute; top: 0; left: 0; width: 100%; background: rgba(139, 0, 0, 0.8); color: white; padding: 5px; font-size: 14px; font-weight: bold; overflow: hidden; white-space: nowrap; border-bottom: 2px solid #ff0000;
        }
        .ticker-move { display: inline-block; animation: ticker 20s linear infinite; }
        @keyframes ticker { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        /* ë°ì´í„° íŒ¨ë„ */
        #data-panel {
            position: absolute; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); border: 1px solid #ff4d4f; padding: 15px; border-radius: 10px; width: 250px; pointer-events: auto;
        }
        .data-stat { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px; font-weight: bold; }
        .dna-val { color: #fadb14; }

        /* ì§„í™” ë²„íŠ¼ */
        .evolve-btn {
            width: 100%; padding: 10px; background: #8b0000; color: white; border: 1px solid #ff4d4f; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 5px;
        }
        .evolve-btn:hover { background: #ff0000; }

        #ranking-board { position: absolute; top: 50px; left: 20px; background: rgba(0,0,0,0.7); border-left: 4px solid #ff4d4f; padding: 10px; min-width: 180px; }
        .rank-row { font-size: 13px; margin-bottom: 5px; }

        #game-over { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; border: 5px solid #ff0000; padding: 50px; text-align: center; display: none; pointer-events: auto; z-index: 100; }
        
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="game-ui">
        <div id="news-ticker"><div class="ticker-move" id="ticker-text">ê¸´ê¸‰ ì†ë³´: ì•Œ ìˆ˜ ì—†ëŠ” ê°ì—¼ì›ì´ í•œêµ­ì—ì„œ ìµœì´ˆ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤... ì „ ì„¸ê³„ êµ­ê°€ë“¤ì´ ê²½ê³„ íƒœì„¸ì— ëŒì…í–ˆìŠµë‹ˆë‹¤...</div></div>
        
        <div id="ranking-board">
            <div style="font-size: 10px; margin-bottom: 5px; color: #888;">NATION INFECTION STATUS</div>
            <div id="ranks"></div>
        </div>

        <div id="data-panel">
            <div class="data-stat">DNA: <span id="dna-val" class="dna-val">500</span></div>
            <div class="data-stat" style="font-size: 14px;">ê°ì—¼ë¥ : <span id="infect-rate">0.1</span>%</div>
            <button class="evolve-btn" onclick="spawnUnit('infector')">ê°ì—¼ì› ìƒì„± (100 DNA)</button>
            <button class="evolve-btn" onclick="spawnUnit('mutant')">ë³€ì¢… ê´´ìˆ˜ ì§„í™” (300 DNA)</button>
        </div>

        <div id="game-over">
            <h1 style="color:#ff0000; font-size: 48px;">HUMANITY EXTINCT</h1>
            <p id="over-msg" style="color:white;">ì „ ì§€êµ¬ê°€ ê°ì—¼ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <button onclick="location.reload()" style="background:#ff0000; color:#fff; border:none; padding:15px 30px; cursor:pointer; font-weight:bold; border-radius:30px;">RESTART VIRUS</button>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = 3000, H = 2000;
        let camX = 0, camY = 0, zoom = 0.3, dna = 500;
        let entities = [], minerals = [], projectiles = [];

        const TEAMS = [
            { id: 1, name: "í•œêµ­(Virus)", color: "#ff0000", flag: "â˜£ï¸", start: {x: 2400, y: 1500}, score: 0, alive: true },
            { id: 2, name: "ë¯¸êµ­(Defense)", color: "#1890ff", flag: "ğŸ›¡ï¸", start: {x: 500, y: 500}, score: 0, alive: true },
            { id: 3, name: "ìœ ëŸ½(Center)", color: "#d9d9d9", flag: "ğŸ¥", start: {x: 1500, y: 500}, score: 0, alive: true },
            { id: 4, name: "ë¸Œë¼ì§ˆ(Base)", color: "#52c41a", flag: "ğŸŒ³", start: {x: 800, y: 1500}, score: 0, alive: true }
        ];

        function initGame() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            TEAMS.forEach(team => { 
                for(let i=0; i<10; i++) minerals.push({ x: team.start.x + (Math.random()-0.5)*600, y: team.start.y + (Math.random()-0.5)*600, type: 'bubble' }); 
            });
            TEAMS.forEach(team => entities.push({ id: Math.random(), type: 'core', team: team.id, x: team.start.x, y: team.start.y, hp: 5000, maxHp: 5000, size: 120 }));
            
            camX = TEAMS[0].start.x; camY = TEAMS[0].start.y;
            zoom = Math.min(canvas.width/W, canvas.height/H) * 1.2;

            setInterval(gameLoop, 50);
            requestAnimationFrame(draw);
        }

        function spawnUnit(type) {
            const cost = type === 'infector' ? 100 : 300;
            if(dna < cost) return;
            dna -= cost; updateUI();
            const core = entities.find(e => e.team === 1 && e.type === 'core');
            const u = { id: Math.random(), type: type, team: 1, x: core.x, y: core.y, state: 'idle', cooldown: 0, targetPos: null };
            if(type === 'infector') { u.hp = 200; u.maxHp = 200; u.size = 20; u.speed = 6; u.range = 150; u.damage = 40; }
            else { u.hp = 1000; u.maxHp = 1000; u.size = 40; u.speed = 3; u.range = 300; u.damage = 150; u.splash = 150; }
            entities.push(u);
        }

        function gameLoop() {
            projectiles.forEach((p, idx) => {
                if(!p.target || p.target.hp <= 0) { projectiles.splice(idx, 1); return; }
                const d = Math.hypot(p.target.x - p.x, p.target.y - p.y);
                if(d < 20) {
                    if(p.splash) entities.forEach(ent => { if(ent.team !== p.team && Math.hypot(ent.x - p.x, ent.y - p.y) < p.splash) ent.hp -= p.damage; });
                    else p.target.hp -= p.damage;
                    projectiles.splice(idx, 1);
                } else { p.x += (p.target.x - p.x)/d * p.speed; p.y += (p.target.y - p.y)/d * p.speed; }
            });

            entities.forEach(e => {
                const team = TEAMS.find(t => t.id === e.team);
                if(!team.alive) return;
                
                // ì „ì—¼ë³‘ ì£¼ì‹íšŒì‚¬ ìŠ¤íƒ€ì¼ì˜ ìë™ ì´ë™
                if(!e.targetPos && e.speed > 0) {
                    let enemy = entities.find(ent => ent.team !== e.team && ent.hp > 0);
                    if(enemy) e.targetPos = { x: enemy.x + (Math.random()-0.5)*200, y: enemy.y + (Math.random()-0.5)*200 };
                }

                if(e.targetPos && e.speed > 0) {
                    const d = Math.hypot(e.targetPos.x - e.x, e.targetPos.y - e.y);
                    if(d > 10) { e.x += (e.targetPos.x - e.x)/d * e.speed; e.y += (e.targetPos.y - e.y)/d * e.speed; }
                    else e.targetPos = null;
                }

                if(e.type !== 'core') {
                    if(e.cooldown > 0) e.cooldown--;
                    let enemy = entities.find(ent => ent.team !== e.team && ent.hp > 0 && Math.hypot(ent.x - e.x, ent.y - e.y) < e.range);
                    if(enemy && e.cooldown <= 0) {
                        projectiles.push({ x: e.x, y: e.y, target: enemy, speed: 20, damage: e.damage, team: e.team, type: e.type, splash: e.splash });
                        e.cooldown = e.type === 'mutant' ? 60 : 20;
                    }
                }
            });

            // ìì› ë²„ë¸” ìë™ ìƒì„± ë° íšë“
            if(Math.random() < 0.05) dna += 2; updateUI();

            TEAMS.forEach(t => { if(t.alive && !entities.some(ent => ent.team === t.id && ent.type === 'core')) { t.alive = false; entities = entities.filter(ent => ent.team !== t.id); if(t.id === 1) showEndScreen("MISSION FAILED"); } });
            entities = entities.filter(e => e.hp > 0);
            
            const totalInfect = (entities.filter(e => e.team === 1).length / 10).toFixed(1);
            document.getElementById('infect-rate').innerText = totalInfect;
            if(totalInfect > 90) showEndScreen("HUMANITY EXTINCT", "ë‹¹ì‹ ì˜ ë°”ì´ëŸ¬ìŠ¤ê°€ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤.");

            updateRanking();
        }

        function draw() {
            ctx.fillStyle = '#050000'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2);
            ctx.scale(zoom, zoom);
            ctx.translate(-camX, -camY);

            // ê·¸ë¦¬ë“œ ë° ë°°ê²½ ì§€ë„ ëŠë‚Œ
            ctx.strokeStyle = '#200000'; ctx.lineWidth = 2;
            for(let i=0; i<=W; i+=200) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,H); ctx.stroke(); }
            for(let i=0; i<=H; i+=200) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            // ê°ì—¼ ì˜ì—­ (Heatmap íš¨ê³¼)
            entities.filter(e => e.team === 1).forEach(e => {
                const grad = ctx.createRadialGradient(e.x, e.y, 0, e.x, e.y, 300);
                grad.addColorStop(0, 'rgba(255, 0, 0, 0.2)');
                grad.addColorStop(1, 'rgba(255, 0, 0, 0)');
                ctx.fillStyle = grad; ctx.fillRect(e.x-300, e.y-300, 600, 600);
            });

            projectiles.forEach(p => {
                ctx.fillStyle = '#ff4d4f'; ctx.beginPath(); ctx.arc(p.x, p.y, 8, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 10; ctx.shadowColor = '#ff0000';
            });
            ctx.shadowBlur = 0;

            entities.forEach(e => {
                const team = TEAMS.find(t => t.id === e.team); ctx.fillStyle = team.color;
                if(e.type === 'core') {
                    ctx.beginPath(); ctx.arc(e.x, e.y, e.size/2, 0, Math.PI*2); ctx.fill();
                    ctx.strokeStyle = '#fff'; ctx.lineWidth = 5; ctx.stroke();
                    ctx.fillStyle = '#fff'; ctx.font = '50px Arial'; ctx.fillText(team.flag, e.x-35, e.y+20);
                } else {
                    ctx.beginPath(); ctx.arc(e.x, e.y, e.size, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = '#000'; ctx.font = 'bold 16px Arial'; ctx.fillText(e.type==='infector'?'â˜£ï¸':'ğŸ§Ÿ', e.x-12, e.y+8);
                }
                // HP Bar
                ctx.fillStyle = '#300'; ctx.fillRect(e.x - 50, e.y - e.size - 20, 100, 8);
                ctx.fillStyle = '#f00'; ctx.fillRect(e.x - 50, e.y - e.size - 20, 100 * (e.hp/e.maxHp), 8);
            });

            ctx.restore(); requestAnimationFrame(draw);
        }

        function updateRanking() {
            let html = '';
            [...TEAMS].forEach(t => {
                const status = t.alive ? 'NORMAL' : 'EXTINCT';
                html += `<div class="rank-row" style="color:${t.color}">
                    <span>${t.flag} ${t.name}</span>: [${status}]
                </div>`;
            });
            document.getElementById('ranks').innerHTML = html;
        }

        function showEndScreen(title, msg) { document.getElementById('game-over').style.display = 'block'; }
        function updateUI() { document.getElementById('dna-val').innerText = dna; }

        canvas.addEventListener('wheel', e => { zoom *= (e.deltaY > 0 ? 0.9 : 1.1); zoom = Math.max(0.1, Math.min(2.0, zoom)); });
        let isDragging = false, lastX, lastY;
        canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
        window.addEventListener('mousemove', e => { if(isDragging) { camX -= (e.clientX - lastX)/zoom; camY -= (e.clientY - lastY)/zoom; lastX = e.clientX; lastY = e.clientY; } });
        window.addEventListener('mouseup', () => isDragging = false);

        initGame();
    </script>
</body>
</html>
